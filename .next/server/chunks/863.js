"use strict";exports.id=863,exports.ids=[863],exports.modules={38443:(e,t,a)=>{a.d(t,{C:()=>n});var r=a(10326);a(17577);var s=a(79360),i=a(51223);let o=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:t,...a}){return r.jsx("div",{className:(0,i.cn)(o({variant:t}),e),...a})}},41190:(e,t,a)=>{a.d(t,{I:()=>o});var r=a(10326),s=a(17577),i=a(51223);let o=s.forwardRef(({className:e,type:t,...a},s)=>r.jsx("input",{type:t,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...a}));o.displayName="Input"},44794:(e,t,a)=>{a.d(t,{_:()=>c});var r=a(10326),s=a(17577),i=a(34478),o=a(79360),n=a(51223);let d=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef(({className:e,...t},a)=>r.jsx(i.f,{ref:a,className:(0,n.cn)(d(),e),...t}));c.displayName=i.f.displayName},47272:(e,t,a)=>{a.d(t,{Bt:()=>o,D0:()=>d,E$:()=>m,LV:()=>n,Lj:()=>l,aE:()=>w,cD:()=>y,eJ:()=>i,li:()=>c,ob:()=>p,rM:()=>u,y6:()=>f,yM:()=>s,zf:()=>_});var r=a(2777);let s=async e=>{console.log("Creating event in database...",{creator_id:e.creator_id,title:e.title,category:e.category});let{data:t,error:a}=await r.supabase.from("events").insert({creator_id:e.creator_id,title:e.title,description:e.description,category:e.category,image_url:e.image_url,date:e.date,location:e.location,is_featured:e.is_featured||!1,status:"active"}).select().single();if(a)throw console.error("Event creation error:",a),Error(`Failed to create event: ${a.message} (${a.code||"unknown"})`);if(!t)throw Error("Event creation returned no data");console.log("Event created, ID:",t.id),console.log("Creating ticket types...",e.ticket_types.length);let s=e.ticket_types.map(e=>({event_id:t.id,name:e.name,description:e.description,price:e.price,quantity:e.quantity,is_free:e.is_free||!1})),{error:i}=await r.supabase.from("ticket_types").insert(s);if(i)throw console.error("Ticket types creation error:",i),Error(`Failed to create ticket types: ${i.message} (${i.code||"unknown"})`);return console.log("Ticket types created successfully"),t},i=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("events").update({title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured||!1,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw Error(`Failed to update event: ${s.message}`);if(!a)throw Error("Event update returned no data");let{data:i}=await r.supabase.from("ticket_types").select("id").eq("event_id",e),o=new Set(i?.map(e=>e.id)||[]),n=new Set(t.ticket_types.filter(e=>e.id).map(e=>e.id)),d=Array.from(o).filter(e=>!n.has(e));for(let a of(d.length>0&&await r.supabase.from("ticket_types").delete().in("id",d),t.ticket_types))a.id&&o.has(a.id)?await r.supabase.from("ticket_types").update({name:a.name,description:a.description,price:a.price,quantity:a.quantity,is_free:a.is_free||!1}).eq("id",a.id):await r.supabase.from("ticket_types").insert({event_id:e,name:a.name,description:a.description,price:a.price,quantity:a.quantity,is_free:a.is_free||!1});return a},o=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("events").select("*").eq("id",e).eq("creator_id",t).single();if(s)throw s;if(!a)throw Error("Event not found or access denied");let{error:i}=await r.supabase.from("deleted_events").insert({original_event_id:a.id,creator_id:a.creator_id,title:a.title,description:a.description,category:a.category,image_url:a.image_url,date:a.date,location:a.location,is_featured:a.is_featured,status:"cancelled",deleted_by:t,created_at:a.created_at,updated_at:a.updated_at});if(i)throw i;let{error:o}=await r.supabase.from("events").delete().eq("id",e).eq("creator_id",t);if(o)throw o;return{success:!0}},n=async e=>{let{data:t,error:a}=await r.supabase.from("orders").insert({user_id:e.user_id,event_id:e.event_id,email:e.email,full_name:e.full_name,total_amount:e.total_amount,paystack_reference:e.paystack_reference,payment_status:e.payment_status||"pending"}).select().single();if(a)throw a;let s=e.tickets.map(a=>({ticket_type_id:a.ticket_type_id,event_id:e.event_id,user_id:e.user_id,order_id:t.id,qr_code:a.qr_code,qr_code_data:a.qr_code_data,status:(e.payment_status,"valid")})),{error:i}=await r.supabase.from("tickets").insert(s);if(i)throw i;if("paid"===e.payment_status){let t=new Map;for(let a of e.tickets){let e=t.get(a.ticket_type_id)||0;t.set(a.ticket_type_id,e+1)}for(let[e,a]of t){let{data:t}=await r.supabase.from("ticket_types").select("sold_count").eq("id",e).single();t&&await r.supabase.from("ticket_types").update({sold_count:t.sold_count+a}).eq("id",e)}}return t},d=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("creator_profiles").upsert({user_id:e,...t}).select().single();if(s)throw s;return a},c=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("tickets").select("*, event:events!inner(creator_id, id)").eq("id",e).single();if(s||!a)throw Error("Ticket not found");if(a.event?.creator_id!==t)throw Error("Only the event creator can validate tickets");if("used"===a.status)throw Error("Ticket has already been validated");if("cancelled"===a.status)throw Error("Ticket has been cancelled");let{error:i}=await r.supabase.from("tickets").update({status:"used",checked_in_at:new Date().toISOString(),checked_in_by:t}).eq("id",e);if(i)throw Error(`Failed to validate ticket: ${i.message}`);return await r.supabase.from("qr_scans").insert({ticket_id:e,scanned_by:t,scan_result:"valid"}),{success:!0,ticketId:e}},l=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("users").update({full_name:t.full_name,gender:t.gender,school:t.school,avatar_name:t.avatar_name,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return a},u=async e=>{let{data:t,error:a}=await r.supabase.from("events").select("*").eq("id",e).single();if(a)throw a;if(!t)throw Error("Event not found");let{error:s}=await r.supabase.from("deleted_events").insert({original_event_id:t.id,creator_id:t.creator_id,title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured,status:"cancelled",deleted_by:t.creator_id,created_at:t.created_at,updated_at:t.updated_at});if(s)throw s;let{error:i}=await r.supabase.from("events").delete().eq("id",e);if(i)throw i;return{success:!0}},f=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("users").update({role:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;if("creator"===t){let{data:t}=await r.supabase.from("creator_profiles").select("id").eq("user_id",e).maybeSingle();t||await r.supabase.from("creator_profiles").insert({user_id:e})}return a},_=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("users").update({banned:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return a},p=async(e,t)=>{let{data:a,error:s}=await r.supabase.from("events").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return a},w=async(e,t,a)=>{let{data:s,error:i}=await r.supabase.from("creator_profiles").select("account_balance").eq("user_id",e).single();if(i)throw i;if(!s)throw Error("Creator profile not found");let o=Number(s.account_balance)||0;if(o<t)throw Error(`Insufficient balance. Available: â‚¦${o.toLocaleString()}`);let{data:n,error:d}=await r.supabase.from("withdrawals").insert({creator_id:e,amount:t,status:"pending",...a}).select().single();if(d)throw d;let{error:c}=await r.supabase.from("creator_profiles").update({account_balance:o-t}).eq("user_id",e);if(c)throw c;return await r.supabase.from("wallet_transactions").insert({creator_id:e,type:"withdrawal",amount:-t,status:"pending",description:`Withdrawal request - ${a.bank_name} ${a.bank_account_number}`}),n},m=async(e,t,a)=>{let{data:s,error:i}=await r.supabase.from("withdrawals").update({status:"approved",approved_by:t,approved_at:new Date().toISOString(),admin_note:a}).eq("id",e).select().single();if(i)throw i;return await r.supabase.from("wallet_transactions").update({status:"completed"}).eq("creator_id",s.creator_id).eq("amount",-s.amount).eq("type","withdrawal").eq("status","pending"),s},y=async(e,t,a)=>{let{data:s,error:i}=await r.supabase.from("withdrawals").select("*").eq("id",e).single();if(i)throw i;if(!s)throw Error("Withdrawal not found");let{error:o}=await r.supabase.from("withdrawals").update({status:"rejected",approved_by:t,rejected_at:new Date().toISOString(),admin_note:a}).eq("id",e);if(o)throw o;let{data:n}=await r.supabase.from("creator_profiles").select("account_balance").eq("user_id",s.creator_id).single();if(n){let e=Number(n.account_balance)||0;await r.supabase.from("creator_profiles").update({account_balance:e+Number(s.amount)}).eq("user_id",s.creator_id)}return await r.supabase.from("wallet_transactions").update({status:"failed"}).eq("creator_id",s.creator_id).eq("amount",-s.amount).eq("type","withdrawal").eq("status","pending"),s}},76253:(e,t,a)=>{a.d(t,{AW:()=>b,DK:()=>u,HG:()=>n,IP:()=>g,Q6:()=>_,Qn:()=>d,TX:()=>l,T_:()=>m,Y:()=>o,Y9:()=>q,ZD:()=>c,fX:()=>v,ks:()=>f,nk:()=>i,pj:()=>y,sN:()=>k,vw:()=>s,wY:()=>p,z8:()=>w,zk:()=>h});var r=a(2777);let s=async()=>{let e=new Date().toISOString(),{data:t,error:a}=await r.supabase.from("events").select("*, ticket_types(*)").eq("status","active").gte("date",e).order("created_at",{ascending:!1});if(a)throw a;return t},i=async e=>{let t=new Date().toISOString(),a=r.supabase.from("events").select("*, ticket_types(*), creator:users!events_creator_id_fkey(school)").eq("status","active").gte("date",t);if(e.search&&e.search.trim()){let t=e.search.trim().replace(/%/g,"\\%").replace(/_/g,"\\_");a=a.or(`title.ilike.%${t}%,description.ilike.%${t}%`)}e.category&&"all"!==e.category&&(a=a.eq("category",e.category)),e.location&&e.location.trim()&&(a=a.ilike("location",`%${e.location}%`)),e.dateFrom&&(a=a.gte("date",e.dateFrom)),e.dateTo&&(a=a.lte("date",e.dateTo)),a=a.order("date",{ascending:!0});let{data:s,error:i}=await a;if(i)throw i;let o=s||[];return e.school&&"all"!==e.school&&(o=o.filter(t=>{let a=t.creator;return a?.school===e.school})),o},o=async e=>{let{data:t,error:a}=await r.supabase.from("events").select("*, ticket_types(*)").eq("id",e).single();if(a)throw a;return t},n=async e=>{let{data:t,error:a}=await r.supabase.from("orders").select("*, event:events(*), tickets(*, ticket_type:ticket_types(*))").eq("id",e).single();if(a)throw a;return t},d=async e=>{let{data:t,error:a}=await r.supabase.from("tickets").select("*, event:events(*), ticket_type:ticket_types(*)").eq("id",e).single();if(a)throw a;return t},c=async e=>{let{data:t,error:a}=await r.supabase.from("orders").select("id").eq("user_id",e).eq("payment_status","paid");if(a)throw a;if(!t||0===t.length)return[];let s=t.map(e=>e.id),{data:i,error:o}=await r.supabase.from("tickets").select("*, event:events(*), ticket_type:ticket_types(*), order:orders(*)").eq("user_id",e).in("order_id",s).order("created_at",{ascending:!1});if(o)throw o;return i||[]},l=async e=>{let t=new Date().toISOString(),{data:a,error:s}=await r.supabase.from("events").select("*, ticket_types(*)").eq("creator_id",e).gte("date",t).order("date",{ascending:!0});if(s)throw s;return a},u=async e=>{let t=new Date().toISOString(),{data:a,error:s}=await r.supabase.from("events").select("*, ticket_types(*)").eq("creator_id",e).lt("date",t).order("date",{ascending:!1});if(s)throw s;return a},f=async e=>{let{data:t,error:a}=await r.supabase.from("creator_profiles").select("*").eq("user_id",e).maybeSingle();if(a)throw a;return t||null},_=async e=>{let{data:t,error:a}=await r.supabase.from("orders").select("*, tickets(*)").eq("event_id",e).eq("payment_status","paid");if(a)throw a;let{data:s,error:i}=await r.supabase.from("tickets").select("*, ticket_type:ticket_types(*)").eq("event_id",e);if(i)throw i;return{orders:t||[],tickets:s||[]}},p=async e=>{let{data:t,error:a}=await r.supabase.from("wallet_transactions").select("*").eq("creator_id",e).order("created_at",{ascending:!1});if(a)throw a;return t},w=async e=>{let{data:t,error:a}=await r.supabase.from("withdrawals").select("*").eq("creator_id",e).order("created_at",{ascending:!1});if(a)throw a;return t||[]},m=async()=>{let{data:e,error:t}=await r.supabase.from("withdrawals").select("*, creator:users!withdrawals_creator_id_fkey(id, email, full_name, school)").order("created_at",{ascending:!1});if(t)throw t;return e||[]},y=async e=>{let{data:t,error:a}=await r.supabase.from("creator_profiles").select("account_balance, bank_account_name, bank_account_number, bank_name, bank_code, is_bank_verified").eq("user_id",e).single();if(a)throw a;return t},g=async()=>{let{data:e,error:t}=await r.supabase.from("events").select("*, ticket_types(*), creator:users!events_creator_id_fkey(id, email, full_name, school)").order("created_at",{ascending:!1});if(t)throw t;return e||[]},b=async()=>{let{data:e,error:t}=await r.supabase.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},h=async()=>{let{data:e,error:t}=await r.supabase.from("orders").select("*, event:events(id, title, creator:users!events_creator_id_fkey(id, email, full_name)), user:users(id, email, full_name)").order("created_at",{ascending:!1});if(t)throw t;return e||[]},v=async()=>{let{data:e,error:t}=await r.supabase.from("tickets").select("*, event:events(id, title), ticket_type:ticket_types(id, name, price, is_free), user:users(id, email, full_name), order:orders(id, payment_status)").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching all tickets:",t),t;return e||[]},k=async()=>{let{data:e,error:t}=await r.supabase.from("users").select("*, creator_profile:creator_profiles(*)").eq("role","creator").order("created_at",{ascending:!1});if(t)throw t;return e||[]},q=async()=>{let{data:e,error:t}=await r.supabase.from("events").select("status");if(t)throw t;let a={active:0,draft:0,completed:0,cancelled:0};e?.forEach(e=>{e.status in a&&a[e.status]++});let{data:s,error:i}=await r.supabase.from("users").select("role, banned");if(i)throw i;let o={user:0,creator:0,admin:0},n=0;s?.forEach(e=>{e.role in o&&o[e.role]++,e.banned&&n++});let{data:d,error:c}=await r.supabase.from("orders").select("total_amount, created_at").eq("payment_status","paid");if(c)throw c;let l=d?.reduce((e,t)=>e+parseFloat(t.total_amount||0),0)||0,u=new Date,f=new Date(u.getFullYear(),u.getMonth(),1).toISOString(),_=d?.filter(e=>e.created_at>=f).reduce((e,t)=>e+parseFloat(t.total_amount||0),0)||0,{data:p,error:w}=await r.supabase.from("tickets").select("id");if(w)throw w;let m=p?.length||0,{data:y,error:g}=await r.supabase.from("users").select("id").eq("role","creator");if(g)throw g;let b=y?.length||0;return{events:{total:e?.length||0,byStatus:a},users:{total:s?.length||0,byRole:o,banned:n},revenue:{total:l,thisMonth:_},tickets:{totalSold:m},organizers:{active:b}}}}};