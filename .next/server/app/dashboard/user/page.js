(()=>{var e={};e.id=679,e.ids=[679],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},89229:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),s(59476),s(84752),s(96560);var r=s(23191),a=s(88716),i=s(37922),n=s.n(i),o=s(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["dashboard",{children:["user",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,59476)),"/Users/mac/Desktop/Client projects/frecks-new/app/dashboard/user/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,24697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,84752)),"/Users/mac/Desktop/Client projects/frecks-new/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/mac/Desktop/Client projects/frecks-new/app/not-found.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,24697))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/mac/Desktop/Client projects/frecks-new/app/dashboard/user/page.tsx"],u="/dashboard/user/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/user/page",pathname:"/dashboard/user",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3785:(e,t,s)=>{Promise.resolve().then(s.bind(s,7691))},7691:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var r=s(10326);s(17577);var a=s(35047),i=s(90434),n=s(20108),o=s(91664),l=s(38443),c=s(1572),d=s(77506),u=s(21985),h=s(37358),m=s(77636),p=s(31540),f=s(58407),x=s(94001),y=s(76253),g=s(2453),v=s(2777),b=s(85999),w=s(44976),_=s(10119);function k(){let{profile:e,loading:t,user:s,refreshProfile:k}=(0,x.a)(),j=(0,a.useRouter)(),N=(0,w.NL)(),{data:q,isLoading:M}=(0,n.a)({queryKey:["user-tickets",s?.id],queryFn:()=>(0,y.ZD)(s.id),enabled:!!s?.id&&!t}),S=(0,_.D)({mutationFn:async()=>{if(!s?.id)throw Error("User not authenticated");let{error:e}=await v.supabase.from("users").update({role:"creator"}).eq("id",s.id);if(e)throw e;let{data:t}=await v.supabase.from("creator_profiles").select("id").eq("user_id",s.id).maybeSingle();if(!t){let{error:e}=await v.supabase.from("creator_profiles").insert({user_id:s.id});if(e)throw e}await k()},onSuccess:()=>{b.Am.success("You are now an event organizer!"),N.invalidateQueries({queryKey:["user-tickets"]}),j.push("/dashboard/creator")},onError:e=>{b.Am.error(e?.message||"Failed to become event organizer")}});return t?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):s&&e&&"user"===e.role?(0,r.jsxs)("div",{className:"min-h-screen flex flex-col",children:[r.jsx(f.default,{}),r.jsx("main",{className:"flex-1 pt-20",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold mb-2",children:"My Tickets"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Welcome back, ",e?.full_name||"User","! Here are your tickets."]})]}),(0,r.jsxs)(o.z,{variant:"outline",onClick:()=>S.mutate(),disabled:S.isPending,className:"gap-2 shrink-0",children:[r.jsx(c.Z,{className:"w-4 h-4"}),S.isPending?"Upgrading...":"Become Event Organizer"]})]}),M?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx(d.Z,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),r.jsx("p",{className:"text-muted-foreground",children:"Loading your tickets..."})]}):q&&0!==q.length?r.jsx("div",{className:"grid gap-3",children:q.map(e=>{let t=e.event,s=e.ticket_type,a=e.qr_code_data?.qrCodeImageUrl||e.qr_code_data?.qrCodeImage;return r.jsx("div",{className:"bg-card rounded-xl border border-border p-4 md:p-6 hover:shadow-lg transition-shadow",children:(0,r.jsxs)("div",{className:"flex gap-3 md:gap-4",children:[t?.image_url&&r.jsx("div",{className:"w-20 h-20 md:w-32 md:h-32 rounded-lg overflow-hidden bg-muted shrink-0",children:r.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-full object-cover"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[r.jsx("h3",{className:"text-base md:text-xl font-bold mb-1 truncate",children:t?.title||"Event"}),r.jsx(l.C,{className:"text-xs",children:t?.category||"Event"})]}),r.jsx(l.C,{variant:"valid"===e.status?"default":"used"===e.status?"secondary":"destructive",className:"shrink-0 text-xs",children:"valid"===e.status?"Valid":"used"===e.status?"Used":"Cancelled"})]}),(0,r.jsxs)("div",{className:"space-y-1.5 mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[r.jsx(h.Z,{className:"w-3 h-3 md:w-4 md:h-4 shrink-0"}),r.jsx("span",{className:"truncate",children:t?.date?(0,g.WU)(new Date(t.date),"MMM d, yyyy • h:mm a"):"Date TBD"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[r.jsx(m.Z,{className:"w-3 h-3 md:w-4 md:h-4 shrink-0"}),r.jsx("span",{className:"truncate",children:t?.location||"Location TBD"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pt-3 border-t border-border",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs text-muted-foreground",children:"Ticket Type"}),r.jsx("p",{className:"text-sm md:text-base font-semibold",children:s?.name||"General Admission"}),s?.price!==void 0&&r.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:s.is_free?"Free":`₦${s.price}`})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(i.default,{href:`/invoice/${e.order_id}`,className:"flex-1 sm:flex-initial",children:r.jsx(o.z,{variant:"outline",size:"sm",className:"w-full sm:w-auto text-xs",children:"See Ticket"})}),a&&r.jsx(i.default,{href:`/invoice/${e.order_id}`,className:"flex-1 sm:flex-initial",children:(0,r.jsxs)(o.z,{variant:"hero",size:"sm",className:"w-full sm:w-auto gap-2 text-xs",children:[r.jsx(p.Z,{className:"w-3 h-3 md:w-4 md:h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Download"})]})})]})]})]})]})},e.id)})}):(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx(u.Z,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),r.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No tickets yet"}),r.jsx("p",{className:"text-muted-foreground mb-6",children:"Start exploring events and get your tickets!"}),r.jsx(i.default,{href:"/",children:r.jsx(o.z,{variant:"hero",children:"Browse Events"})})]})]})})]}):null}},37358:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},31540:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},77506:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},77636:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},1572:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])},21985:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},38443:(e,t,s)=>{"use strict";s.d(t,{C:()=>o});var r=s(10326);s(17577);var a=s(79360),i=s(51223);let n=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o({className:e,variant:t,...s}){return r.jsx("div",{className:(0,i.cn)(n({variant:t}),e),...s})}},76253:(e,t,s)=>{"use strict";s.d(t,{AW:()=>v,DK:()=>u,HG:()=>o,IP:()=>g,Q6:()=>m,Qn:()=>l,TX:()=>d,T_:()=>x,Y:()=>n,Y9:()=>k,ZD:()=>c,fX:()=>w,ks:()=>h,nk:()=>i,pj:()=>y,sN:()=>_,vw:()=>a,wY:()=>p,z8:()=>f,zk:()=>b});var r=s(2777);let a=async()=>{let e=new Date().toISOString(),{data:t,error:s}=await r.supabase.from("events").select("*, ticket_types(*)").eq("status","active").gte("date",e).order("created_at",{ascending:!1});if(s)throw s;return t},i=async e=>{let t=new Date().toISOString(),s=r.supabase.from("events").select("*, ticket_types(*), creator:users!events_creator_id_fkey(school)").eq("status","active").gte("date",t);if(e.search&&e.search.trim()){let t=e.search.trim().replace(/%/g,"\\%").replace(/_/g,"\\_");s=s.or(`title.ilike.%${t}%,description.ilike.%${t}%`)}e.category&&"all"!==e.category&&(s=s.eq("category",e.category)),e.location&&e.location.trim()&&(s=s.ilike("location",`%${e.location}%`)),e.dateFrom&&(s=s.gte("date",e.dateFrom)),e.dateTo&&(s=s.lte("date",e.dateTo)),s=s.order("date",{ascending:!0});let{data:a,error:i}=await s;if(i)throw i;let n=a||[];return e.school&&"all"!==e.school&&(n=n.filter(t=>{let s=t.creator;return s?.school===e.school})),n},n=async e=>{let{data:t,error:s}=await r.supabase.from("events").select("*, ticket_types(*)").eq("id",e).single();if(s)throw s;return t},o=async e=>{let{data:t,error:s}=await r.supabase.from("orders").select("*, event:events(*), tickets(*, ticket_type:ticket_types(*))").eq("id",e).single();if(s)throw s;return t},l=async e=>{let{data:t,error:s}=await r.supabase.from("tickets").select("*, event:events(*), ticket_type:ticket_types(*)").eq("id",e).single();if(s)throw s;return t},c=async e=>{let{data:t,error:s}=await r.supabase.from("orders").select("id").eq("user_id",e).eq("payment_status","paid");if(s)throw s;if(!t||0===t.length)return[];let a=t.map(e=>e.id),{data:i,error:n}=await r.supabase.from("tickets").select("*, event:events(*), ticket_type:ticket_types(*), order:orders(*)").eq("user_id",e).in("order_id",a).order("created_at",{ascending:!1});if(n)throw n;return i||[]},d=async e=>{let t=new Date().toISOString(),{data:s,error:a}=await r.supabase.from("events").select("*, ticket_types(*)").eq("creator_id",e).gte("date",t).order("date",{ascending:!0});if(a)throw a;return s},u=async e=>{let t=new Date().toISOString(),{data:s,error:a}=await r.supabase.from("events").select("*, ticket_types(*)").eq("creator_id",e).lt("date",t).order("date",{ascending:!1});if(a)throw a;return s},h=async e=>{let{data:t,error:s}=await r.supabase.from("creator_profiles").select("*").eq("user_id",e).maybeSingle();if(s)throw s;return t||null},m=async e=>{let{data:t,error:s}=await r.supabase.from("orders").select("*, tickets(*)").eq("event_id",e).eq("payment_status","paid");if(s)throw s;let{data:a,error:i}=await r.supabase.from("tickets").select("*, ticket_type:ticket_types(*)").eq("event_id",e);if(i)throw i;return{orders:t||[],tickets:a||[]}},p=async e=>{let{data:t,error:s}=await r.supabase.from("wallet_transactions").select("*").eq("creator_id",e).order("created_at",{ascending:!1});if(s)throw s;return t},f=async e=>{let{data:t,error:s}=await r.supabase.from("withdrawals").select("*").eq("creator_id",e).order("created_at",{ascending:!1});if(s)throw s;return t||[]},x=async()=>{let{data:e,error:t}=await r.supabase.from("withdrawals").select("*, creator:users!withdrawals_creator_id_fkey(id, email, full_name, school)").order("created_at",{ascending:!1});if(t)throw t;return e||[]},y=async e=>{let{data:t,error:s}=await r.supabase.from("creator_profiles").select("account_balance, bank_account_name, bank_account_number, bank_name, bank_code, is_bank_verified").eq("user_id",e).single();if(s)throw s;return t},g=async()=>{let{data:e,error:t}=await r.supabase.from("events").select("*, ticket_types(*), creator:users!events_creator_id_fkey(id, email, full_name, school)").order("created_at",{ascending:!1});if(t)throw t;return e||[]},v=async()=>{let{data:e,error:t}=await r.supabase.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},b=async()=>{let{data:e,error:t}=await r.supabase.from("orders").select("*, event:events(id, title, creator:users!events_creator_id_fkey(id, email, full_name)), user:users(id, email, full_name)").order("created_at",{ascending:!1});if(t)throw t;return e||[]},w=async()=>{let{data:e,error:t}=await r.supabase.from("tickets").select("*, event:events(id, title), ticket_type:ticket_types(id, name, price, is_free), user:users(id, email, full_name), order:orders(id, payment_status)").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching all tickets:",t),t;return e||[]},_=async()=>{let{data:e,error:t}=await r.supabase.from("users").select("*, creator_profile:creator_profiles(*)").eq("role","creator").order("created_at",{ascending:!1});if(t)throw t;return e||[]},k=async()=>{let{data:e,error:t}=await r.supabase.from("events").select("status");if(t)throw t;let s={active:0,draft:0,completed:0,cancelled:0};e?.forEach(e=>{e.status in s&&s[e.status]++});let{data:a,error:i}=await r.supabase.from("users").select("role, banned");if(i)throw i;let n={user:0,creator:0,admin:0},o=0;a?.forEach(e=>{e.role in n&&n[e.role]++,e.banned&&o++});let{data:l,error:c}=await r.supabase.from("orders").select("total_amount, created_at").eq("payment_status","paid");if(c)throw c;let d=l?.reduce((e,t)=>e+parseFloat(t.total_amount||0),0)||0,u=new Date,h=new Date(u.getFullYear(),u.getMonth(),1).toISOString(),m=l?.filter(e=>e.created_at>=h).reduce((e,t)=>e+parseFloat(t.total_amount||0),0)||0,{data:p,error:f}=await r.supabase.from("tickets").select("id");if(f)throw f;let x=p?.length||0,{data:y,error:g}=await r.supabase.from("users").select("id").eq("role","creator");if(g)throw g;let v=y?.length||0;return{events:{total:e?.length||0,byStatus:s},users:{total:a?.length||0,byRole:n,banned:o},revenue:{total:d,thisMonth:m},tickets:{totalSold:x},organizers:{active:v}}}},59476:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/mac/Desktop/Client projects/frecks-new/app/dashboard/user/page.tsx#default`)},10119:(e,t,s)=>{"use strict";s.d(t,{D:()=>d});var r=s(17577),a=s(71180),i=s(12113),n=s(64351),o=s(3341),l=class extends n.l{#e;#t=void 0;#s;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,o.VS)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(t.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#a(),this.#i(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#a(),this.#i()}mutate(e,t){return this.#r=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#a(){let e=this.#s?.state??(0,a.R)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#i(e){i.Vr.batch(()=>{if(this.#r&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context;e?.type==="success"?(this.#r.onSuccess?.(e.data,t,s),this.#r.onSettled?.(e.data,null,t,s)):e?.type==="error"&&(this.#r.onError?.(e.error,t,s),this.#r.onSettled?.(void 0,e.error,t,s))}this.listeners.forEach(e=>{e(this.#t)})})}},c=s(44976);function d(e,t){let s=(0,c.NL)(t),[a]=r.useState(()=>new l(s,e));r.useEffect(()=>{a.setOptions(e)},[a,e]);let n=r.useSyncExternalStore(r.useCallback(e=>a.subscribe(i.Vr.batchCalls(e)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),d=r.useCallback((e,t)=>{a.mutate(e,t).catch(o.ZT)},[a]);if(n.error&&(0,o.L3)(a.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:d,mutateAsync:n.mutate}}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,759,65,453,561,812,643,108,236,407],()=>s(89229));module.exports=r})();