"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8748],{30767:function(e,t,a){a.d(t,{OL:function(){return w},_T:function(){return u},aR:function(){return d},f$:function(){return _},fY:function(){return f},le:function(){return y},xo:function(){return p},yT:function(){return m}});var r=a(57437),i=a(2265),s=a(90277),n=a(93448),o=a(12381);let d=s.fC;s.xz;let c=s.h_,l=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(s.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...i,ref:t})});l.displayName=s.aV.displayName;let u=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(l,{}),(0,r.jsx)(s.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...i})]})});u.displayName=s.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};f.displayName="AlertDialogHeader";let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="AlertDialogFooter";let _=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(s.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold",a),...i})});_.displayName=s.Dx.displayName;let m=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(s.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...i})});m.displayName=s.dk.displayName;let w=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(s.aU,{ref:t,className:(0,n.cn)((0,o.d)(),a),...i})});w.displayName=s.aU.displayName;let y=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(s.$j,{ref:t,className:(0,n.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...i})});y.displayName=s.$j.displayName},40279:function(e,t,a){a.d(t,{I:function(){return n}});var r=a(57437),i=a(2265),s=a(93448);let n=i.forwardRef((e,t)=>{let{className:a,type:i,...n}=e;return(0,r.jsx)("input",{type:i,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});n.displayName="Input"},75060:function(e,t,a){a.d(t,{_:function(){return c}});var r=a(57437),i=a(2265),s=a(6394),n=a(90535),o=a(93448);let d=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(s.f,{ref:t,className:(0,o.cn)(d(),a),...i})});c.displayName=s.f.displayName},61980:function(e,t,a){a.d(t,{Bt:function(){return n},D0:function(){return d},E$:function(){return w},LV:function(){return o},Lj:function(){return l},aE:function(){return m},cD:function(){return y},eJ:function(){return s},li:function(){return c},ob:function(){return _},rM:function(){return u},y6:function(){return f},yM:function(){return i},zf:function(){return p}});var r=a(5526);let i=async e=>{console.log("Creating event in database...",{creator_id:e.creator_id,title:e.title,category:e.category});let{data:t,error:a}=await r.supabase.from("events").insert({creator_id:e.creator_id,title:e.title,description:e.description,category:e.category,image_url:e.image_url,date:e.date,location:e.location,is_featured:e.is_featured||!1,status:"active"}).select().single();if(a)throw console.error("Event creation error:",a),Error("Failed to create event: ".concat(a.message," (").concat(a.code||"unknown",")"));if(!t)throw Error("Event creation returned no data");console.log("Event created, ID:",t.id),console.log("Creating ticket types...",e.ticket_types.length);let i=e.ticket_types.map(e=>({event_id:t.id,name:e.name,description:e.description,price:e.price,quantity:e.quantity,is_free:e.is_free||!1})),{error:s}=await r.supabase.from("ticket_types").insert(i);if(s)throw console.error("Ticket types creation error:",s),Error("Failed to create ticket types: ".concat(s.message," (").concat(s.code||"unknown",")"));return console.log("Ticket types created successfully"),t},s=async(e,t)=>{let{data:a,error:i}=await r.supabase.from("events").update({title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured||!1,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw Error("Failed to update event: ".concat(i.message));if(!a)throw Error("Event update returned no data");let{data:s}=await r.supabase.from("ticket_types").select("id").eq("event_id",e),n=new Set((null==s?void 0:s.map(e=>e.id))||[]),o=new Set(t.ticket_types.filter(e=>e.id).map(e=>e.id)),d=Array.from(n).filter(e=>!o.has(e));for(let a of(d.length>0&&await r.supabase.from("ticket_types").delete().in("id",d),t.ticket_types))a.id&&n.has(a.id)?await r.supabase.from("ticket_types").update({name:a.name,description:a.description,price:a.price,quantity:a.quantity,is_free:a.is_free||!1}).eq("id",a.id):await r.supabase.from("ticket_types").insert({event_id:e,name:a.name,description:a.description,price:a.price,quantity:a.quantity,is_free:a.is_free||!1});return a},n=async(e,t)=>{let{data:a,error:i}=await r.supabase.from("events").select("*").eq("id",e).eq("creator_id",t).single();if(i)throw i;if(!a)throw Error("Event not found or access denied");let{error:s}=await r.supabase.from("deleted_events").insert({original_event_id:a.id,creator_id:a.creator_id,title:a.title,description:a.description,category:a.category,image_url:a.image_url,date:a.date,location:a.location,is_featured:a.is_featured,status:"cancelled",deleted_by:t,created_at:a.created_at,updated_at:a.updated_at});if(s)throw s;let{error:n}=await r.supabase.from("events").delete().eq("id",e).eq("creator_id",t);if(n)throw n;return{success:!0}},o=async e=>{let{data:t,error:a}=await r.supabase.from("orders").insert({user_id:e.user_id,event_id:e.event_id,email:e.email,full_name:e.full_name,total_amount:e.total_amount,paystack_reference:e.paystack_reference,payment_status:e.payment_status||"pending"}).select().single();if(a)throw a;let i=e.tickets.map(a=>({ticket_type_id:a.ticket_type_id,event_id:e.event_id,user_id:e.user_id,order_id:t.id,qr_code:a.qr_code,qr_code_data:a.qr_code_data,status:(e.payment_status,"valid")})),{error:s}=await r.supabase.from("tickets").insert(i);if(s)throw s;if("paid"===e.payment_status){let t=new Map;for(let a of e.tickets){let e=t.get(a.ticket_type_id)||0;t.set(a.ticket_type_id,e+1)}for(let[e,a]of t){let{data:t}=await r.supabase.from("ticket_types").select("sold_count").eq("id",e).single();t&&await r.supabase.from("ticket_types").update({sold_count:t.sold_count+a}).eq("id",e)}}return t},d=async(e,t)=>{let{data:a,error:i}=await r.supabase.from("creator_profiles").upsert({user_id:e,...t}).select().single();if(i)throw i;return a},c=async(e,t)=>{var a;let{data:i,error:s}=await r.supabase.from("tickets").select("*, event:events!inner(creator_id, id)").eq("id",e).single();if(s||!i)throw Error("Ticket not found");if((null===(a=i.event)||void 0===a?void 0:a.creator_id)!==t)throw Error("Only the event creator can validate tickets");if("used"===i.status)throw Error("Ticket has already been validated");if("cancelled"===i.status)throw Error("Ticket has been cancelled");let{error:n}=await r.supabase.from("tickets").update({status:"used",checked_in_at:new Date().toISOString(),checked_in_by:t}).eq("id",e);if(n)throw Error("Failed to validate ticket: ".concat(n.message));return await r.supabase.from("qr_scans").insert({ticket_id:e,scanned_by:t,scan_result:"valid"}),{success:!0,ticketId:e}},l=async(e,t)=>{let{data:a,error:i}=await r.supabase.from("users").update({full_name:t.full_name,gender:t.gender,school:t.school,avatar_name:t.avatar_name,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return a},u=async e=>{let{data:t,error:a}=await r.supabase.from("events").select("*").eq("id",e).single();if(a)throw a;if(!t)throw Error("Event not found");let{error:i}=await r.supabase.from("deleted_events").insert({original_event_id:t.id,creator_id:t.creator_id,title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured,status:"cancelled",deleted_by:t.creator_id,created_at:t.created_at,updated_at:t.updated_at});if(i)throw i;let{error:s}=await r.supabase.from("events").delete().eq("id",e);if(s)throw s;return{success:!0}},f=async(e,t)=>{let{data:a,error:i}=await r.supabase.from("users").update({role:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;if("creator"===t){let{data:t}=await r.supabase.from("creator_profiles").select("id").eq("user_id",e).maybeSingle();t||await r.supabase.from("creator_profiles").insert({user_id:e})}return a},p=async(e,t)=>{let{data:a,error:i}=await r.supabase.from("users").update({banned:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return a},_=async(e,t)=>{let{data:a,error:i}=await r.supabase.from("events").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return a},m=async(e,t,a)=>{let{data:i,error:s}=await r.supabase.from("creator_profiles").select("account_balance").eq("user_id",e).single();if(s)throw s;if(!i)throw Error("Creator profile not found");let n=Number(i.account_balance)||0;if(n<t)throw Error("Insufficient balance. Available: â‚¦".concat(n.toLocaleString()));let{data:o,error:d}=await r.supabase.from("withdrawals").insert({creator_id:e,amount:t,status:"pending",...a}).select().single();if(d)throw d;let{error:c}=await r.supabase.from("creator_profiles").update({account_balance:n-t}).eq("user_id",e);if(c)throw c;return await r.supabase.from("wallet_transactions").insert({creator_id:e,type:"withdrawal",amount:-t,status:"pending",description:"Withdrawal request - ".concat(a.bank_name," ").concat(a.bank_account_number)}),o},w=async(e,t,a)=>{let{data:i,error:s}=await r.supabase.from("withdrawals").update({status:"approved",approved_by:t,approved_at:new Date().toISOString(),admin_note:a}).eq("id",e).select().single();if(s)throw s;return await r.supabase.from("wallet_transactions").update({status:"completed"}).eq("creator_id",i.creator_id).eq("amount",-i.amount).eq("type","withdrawal").eq("status","pending"),i},y=async(e,t,a)=>{let{data:i,error:s}=await r.supabase.from("withdrawals").select("*").eq("id",e).single();if(s)throw s;if(!i)throw Error("Withdrawal not found");let{error:n}=await r.supabase.from("withdrawals").update({status:"rejected",approved_by:t,rejected_at:new Date().toISOString(),admin_note:a}).eq("id",e);if(n)throw n;let{data:o}=await r.supabase.from("creator_profiles").select("account_balance").eq("user_id",i.creator_id).single();if(o){let e=Number(o.account_balance)||0;await r.supabase.from("creator_profiles").update({account_balance:e+Number(i.amount)}).eq("user_id",i.creator_id)}return await r.supabase.from("wallet_transactions").update({status:"failed"}).eq("creator_id",i.creator_id).eq("amount",-i.amount).eq("type","withdrawal").eq("status","pending"),i}}}]);