"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{2381:function(e,t,r){r.d(t,{d:function(){return l},z:function(){return u}});var a=r(7437),i=r(2265),n=r(7495),o=r(535),s=r(3448);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-full text-sm font-semibold transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-button hover:brightness-110 active:scale-95",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground",secondary:"bg-secondary text-secondary-foreground hover:brightness-110 active:scale-95",ghost:"hover:bg-muted hover:text-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-primary text-primary-foreground shadow-button hover:brightness-110 active:scale-95 font-bold",accent:"bg-accent text-accent-foreground border border-border hover:bg-muted active:scale-95"},size:{default:"h-11 px-6 py-2",sm:"h-9 px-4 text-xs",lg:"h-14 px-8 text-base",xl:"h-16 px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=i.forwardRef((e,t)=>{let{className:r,variant:i,size:o,asChild:u=!1,...d}=e,c=u?n.g7:"button";return(0,a.jsx)(c,{className:(0,s.cn)(l({variant:i,size:o,className:r})),ref:t,...d})});u.displayName="Button"},279:function(e,t,r){r.d(t,{I:function(){return o}});var a=r(7437),i=r(2265),n=r(3448);let o=i.forwardRef((e,t)=>{let{className:r,type:i,...o}=e;return(0,a.jsx)("input",{type:i,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...o})});o.displayName="Input"},5060:function(e,t,r){r.d(t,{_:function(){return u}});var a=r(7437),i=r(2265),n=r(6394),o=r(535),s=r(3448);let l=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,a.jsx)(n.f,{ref:t,className:(0,s.cn)(l(),r),...i})});u.displayName=n.f.displayName},3675:function(e,t,r){r.d(t,{g:function(){return o}});var a=r(7437),i=r(2265),n=r(3448);let o=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...i})});o.displayName="Textarea"},4362:function(e,t,r){r.d(t,{H:function(){return l},a:function(){return s}});var a=r(7437),i=r(2265),n=r(5526);let o=(0,i.createContext)(void 0),s=()=>{let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[r,s]=(0,i.useState)(null),[l,u]=(0,i.useState)(null),[d,c]=(0,i.useState)(null),[f,p]=(0,i.useState)(!0),v=(0,i.useRef)(null),_=async e=>{if(v.current!==e){v.current=e;try{let{data:t,error:r}=await n.supabase.from("users").select("id, email, full_name, role, gender, school, avatar_name, avatar_url").eq("id",e).single();if(r)throw r;t?u({id:t.id,email:t.email,full_name:t.full_name,role:t.role||"user",gender:t.gender||null,school:t.school||null,avatar_name:t.avatar_name||null,avatar_url:t.avatar_url||null}):u(null)}catch(e){console.error("Error fetching profile:",e),u(null)}finally{v.current=null}}},m=async()=>{r&&(v.current=null,await _(r.id))};(0,i.useEffect)(()=>{let e=!0,t=null;n.supabase.auth.getSession().then(r=>{var a,i,n;let{data:{session:o},error:l}=r;if(e){if(l){p(!1);return}c(o),s(null!==(i=null==o?void 0:o.user)&&void 0!==i?i:null),t=null!==(n=null==o?void 0:null===(a=o.user)||void 0===a?void 0:a.id)&&void 0!==n?n:null,(null==o?void 0:o.user)&&_(o.user.id),e&&p(!1)}});let{data:{subscription:r}}=n.supabase.auth.onAuthStateChange((r,a)=>{var i,n,o;if(!e)return;let l=null!==(n=null==a?void 0:null===(i=a.user)||void 0===i?void 0:i.id)&&void 0!==n?n:null;l!==t&&(c(a),s(null!==(o=null==a?void 0:a.user)&&void 0!==o?o:null),t=l,(null==a?void 0:a.user)?_(a.user.id):u(null))});return()=>{e=!1,r.unsubscribe()}},[]);let g=async()=>{await n.supabase.auth.signOut(),s(null),u(null),c(null),v.current=null};return(0,a.jsx)(o.Provider,{value:{user:r,profile:l,session:d,loading:f,signOut:g,refreshProfile:m},children:t})}},5526:function(e,t,r){r.d(t,{supabase:function(){return u}});var a,i,n=r(8280),o=r(257);let s=(void 0!==o?null===(a=o.env)||void 0===a?void 0:"https://ynkvvjkokwwnqoujeznu.supabase.co":void 0)||"",l=(void 0!==o?null===(i=o.env)||void 0===i?void 0:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlua3Z2amtva3d3bnFvdWplem51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NjE2ODMsImV4cCI6MjA4NDMzNzY4M30.tVFWjO_kqz2iY3GpunHC78czG6Tb2Ikhl1HbVoINbCg":void 0)||"";if(!s||!l){let e="Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your .env.local file. (Note: In Next.js, client-side env vars must be prefixed with NEXT_PUBLIC_)";throw console.error(e),Error(e)}let u=(0,n.eI)(s,l,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},1980:function(e,t,r){r.d(t,{Bt:function(){return o},D0:function(){return l},LV:function(){return s},Lj:function(){return d},eJ:function(){return n},li:function(){return u},yM:function(){return i}});var a=r(5526);let i=async e=>{console.log("Creating event in database...",{creator_id:e.creator_id,title:e.title,category:e.category});let{data:t,error:r}=await a.supabase.from("events").insert({creator_id:e.creator_id,title:e.title,description:e.description,category:e.category,image_url:e.image_url,date:e.date,location:e.location,is_featured:e.is_featured||!1,status:"active"}).select().single();if(r)throw console.error("Event creation error:",r),Error("Failed to create event: ".concat(r.message," (").concat(r.code||"unknown",")"));if(!t)throw Error("Event creation returned no data");console.log("Event created, ID:",t.id),console.log("Creating ticket types...",e.ticket_types.length);let i=e.ticket_types.map(e=>({event_id:t.id,name:e.name,description:e.description,price:e.price,quantity:e.quantity,is_free:e.is_free||!1})),{error:n}=await a.supabase.from("ticket_types").insert(i);if(n)throw console.error("Ticket types creation error:",n),Error("Failed to create ticket types: ".concat(n.message," (").concat(n.code||"unknown",")"));return console.log("Ticket types created successfully"),t},n=async(e,t)=>{let{data:r,error:i}=await a.supabase.from("events").update({title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured||!1,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw Error("Failed to update event: ".concat(i.message));if(!r)throw Error("Event update returned no data");let{data:n}=await a.supabase.from("ticket_types").select("id").eq("event_id",e),o=new Set((null==n?void 0:n.map(e=>e.id))||[]),s=new Set(t.ticket_types.filter(e=>e.id).map(e=>e.id)),l=Array.from(o).filter(e=>!s.has(e));for(let r of(l.length>0&&await a.supabase.from("ticket_types").delete().in("id",l),t.ticket_types))r.id&&o.has(r.id)?await a.supabase.from("ticket_types").update({name:r.name,description:r.description,price:r.price,quantity:r.quantity,is_free:r.is_free||!1}).eq("id",r.id):await a.supabase.from("ticket_types").insert({event_id:e,name:r.name,description:r.description,price:r.price,quantity:r.quantity,is_free:r.is_free||!1});return r},o=async(e,t)=>{let{data:r,error:i}=await a.supabase.from("events").select("*").eq("id",e).eq("creator_id",t).single();if(i)throw i;if(!r)throw Error("Event not found or access denied");let{error:n}=await a.supabase.from("deleted_events").insert({original_event_id:r.id,creator_id:r.creator_id,title:r.title,description:r.description,category:r.category,image_url:r.image_url,date:r.date,location:r.location,is_featured:r.is_featured,status:"cancelled",deleted_by:t,created_at:r.created_at,updated_at:r.updated_at});if(n)throw n;let{error:o}=await a.supabase.from("events").delete().eq("id",e).eq("creator_id",t);if(o)throw o;return{success:!0}},s=async e=>{let{data:t,error:r}=await a.supabase.from("orders").insert({user_id:e.user_id,event_id:e.event_id,email:e.email,full_name:e.full_name,total_amount:e.total_amount,paystack_reference:e.paystack_reference,payment_status:e.payment_status||"pending"}).select().single();if(r)throw r;let i=e.tickets.map(r=>({ticket_type_id:r.ticket_type_id,event_id:e.event_id,user_id:e.user_id,order_id:t.id,qr_code:r.qr_code,qr_code_data:r.qr_code_data,status:(e.payment_status,"valid")})),{error:n}=await a.supabase.from("tickets").insert(i);if(n)throw n;if("paid"===e.payment_status){let t=new Map;for(let r of e.tickets){let e=t.get(r.ticket_type_id)||0;t.set(r.ticket_type_id,e+1)}for(let[e,r]of t){let{data:t}=await a.supabase.from("ticket_types").select("sold_count").eq("id",e).single();t&&await a.supabase.from("ticket_types").update({sold_count:t.sold_count+r}).eq("id",e)}}return t},l=async(e,t)=>{let{data:r,error:i}=await a.supabase.from("creator_profiles").upsert({user_id:e,...t}).select().single();if(i)throw i;return r},u=async(e,t)=>{var r;let{data:i,error:n}=await a.supabase.from("tickets").select("*, event:events!inner(creator_id, id)").eq("id",e).single();if(n||!i)throw Error("Ticket not found");if((null===(r=i.event)||void 0===r?void 0:r.creator_id)!==t)throw Error("Only the event creator can validate tickets");if("used"===i.status)throw Error("Ticket has already been validated");if("cancelled"===i.status)throw Error("Ticket has been cancelled");let{error:o}=await a.supabase.from("tickets").update({status:"used",checked_in_at:new Date().toISOString(),checked_in_by:t}).eq("id",e);if(o)throw Error("Failed to validate ticket: ".concat(o.message));return await a.supabase.from("qr_scans").insert({ticket_id:e,scanned_by:t,scan_result:"valid"}),{success:!0,ticketId:e}},d=async(e,t)=>{let{data:r,error:i}=await a.supabase.from("users").update({full_name:t.full_name,gender:t.gender,school:t.school,avatar_name:t.avatar_name,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return r}},3448:function(e,t,r){r.d(t,{cn:function(){return n}});var a=r(1994),i=r(3335);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.m6)((0,a.W)(t))}}}]);