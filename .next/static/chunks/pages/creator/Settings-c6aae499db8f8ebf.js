(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{2803:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/creator/Settings",function(){return a(4467)}])},6573:function(e,n,a){"use strict";a.d(n,{supabase:function(){return l}});var t,r,o=a(2629),i=a(3454);let s=(void 0!==i?null===(t=i.env)||void 0===t?void 0:"https://ynkvvjkokwwnqoujeznu.supabase.co":void 0)||"",c=(void 0!==i?null===(r=i.env)||void 0===r?void 0:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlua3Z2amtva3d3bnFvdWplem51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NjE2ODMsImV4cCI6MjA4NDMzNzY4M30.tVFWjO_kqz2iY3GpunHC78czG6Tb2Ikhl1HbVoINbCg":void 0)||"";if(!s||!c){let e="Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your .env.local file. (Note: In Next.js, client-side env vars must be prefixed with NEXT_PUBLIC_)";throw console.error(e),Error(e)}let l=(0,o.eI)(s,c,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},4467:function(e,n,a){"use strict";a.r(n),a.d(n,{__N_SSP:function(){return O},default:function(){return z}});var t,r=a(5893),o=a(7294),i=a(7536),s=a(9832),c=a(147),l=a(202),d=a(1914),u=a(6454),m=a(1465),b=a(2003),_=a(512),f=a(8388);function v(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return(0,f.m6)((0,_.W)(n))}let k=(0,b.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-full text-sm font-semibold transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-button hover:brightness-110 active:scale-95",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground",secondary:"bg-secondary text-secondary-foreground hover:brightness-110 active:scale-95",ghost:"hover:bg-muted hover:text-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-primary text-primary-foreground shadow-button hover:brightness-110 active:scale-95 font-bold",accent:"bg-accent text-accent-foreground border border-border hover:bg-muted active:scale-95"},size:{default:"h-11 px-6 py-2",sm:"h-9 px-4 text-xs",lg:"h-14 px-8 text-base",xl:"h-16 px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),h=o.forwardRef((e,n)=>{let{className:a,variant:t,size:o,asChild:i=!1,...s}=e,c=i?m.g7:"button";return(0,r.jsx)(c,{className:v(k({variant:t,size:o,className:a})),ref:n,...s})});h.displayName="Button";let g=o.forwardRef((e,n)=>{let{className:a,type:t,...o}=e;return(0,r.jsx)("input",{type:t,className:v("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:n,...o})});g.displayName="Input";var x=a(3440);let p=(0,b.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),y=o.forwardRef((e,n)=>{let{className:a,...t}=e;return(0,r.jsx)(x.f,{ref:n,className:v(p(),a),...t})});y.displayName=x.f.displayName;var w=a(6573);let N=(0,o.createContext)(void 0),j=()=>{let e=(0,o.useContext)(N);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},S=async e=>{let{data:n,error:a}=await w.supabase.from("creator_profiles").select("*").eq("user_id",e).maybeSingle();if(a)throw a;return n||null},E=async(e,n)=>{let{data:a,error:t}=await w.supabase.from("creator_profiles").upsert({user_id:e,...n}).select().single();if(t)throw t;return a};var A=a(3454);(void 0!==A?null===(t=A.env)||void 0===t?void 0:"pk_test_305a29a2af6419e97f6aaf29d62c648d334d8a1c":void 0)||console.warn("Paystack public key is not set. Payment functionality will not work.");let P=async()=>{try{try{let e=await fetch("/api/get-banks",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){let n=await e.json().catch(()=>({}));throw Error(n.error||"HTTP error! status: ".concat(e.status))}let n=await e.json();if(n.error)throw Error(n.error);let a=n.banks||[];return console.log("Banks from API route:",a.length,"banks"),0===a.length&&console.warn("Empty banks array returned"),a}catch(o){console.warn("API route failed, trying edge function:",o.message);let{supabase:e}=await Promise.resolve().then(a.bind(a,6573)),{data:{session:n}}=await e.auth.getSession(),{data:t,error:r}=await e.functions.invoke("get-paystack-banks",{headers:{Authorization:n?"Bearer ".concat(n.access_token):""}});if(r)throw r;if(!t)throw Error("No response from bank service");if(t.error)throw Error(t.error);return t.banks||[]}}catch(n){console.error("Error fetching banks:",n);let e=n.message||JSON.stringify(n);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))throw Error("Bank service is not available. Please check your environment variables (PAYSTACK_SECRET_KEY) and try again.");throw Error(n.message||"Failed to fetch banks. Please try again.")}},C=async e=>{try{if(!e.account_number||!e.bank_code)return{verified:!1,error:"Account number and bank code are required"};if(10!==e.account_number.length)return{verified:!1,error:"Account number must be exactly 10 digits"};try{let n=await fetch("/api/verify-bank-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||"HTTP error! status: ".concat(n.status))}let a=await n.json();if(a.error)return{verified:!1,error:a.error};return{verified:a.verified||!1,account_name:a.account_name,account_number:a.account_number,bank_id:a.bank_id}}catch(i){console.warn("API route failed, trying edge function:",i.message);let{supabase:n}=await Promise.resolve().then(a.bind(a,6573)),{data:{session:t}}=await n.auth.getSession(),{data:r,error:o}=await n.functions.invoke("verify-bank-account",{body:e,headers:{Authorization:t?"Bearer ".concat(t.access_token):""}});if(o)throw o;if(!r)return{verified:!1,error:"No response from verification service"};if(r.error)return{verified:!1,error:r.error};return{verified:r.verified||!1,account_name:r.account_name,account_number:r.account_number,bank_id:r.bank_id}}}catch(n){console.error("Bank verification error:",n);let e=n.message||JSON.stringify(n);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))return{verified:!1,error:"Bank verification service is not available. Please check your environment variables (PAYSTACK_SECRET_KEY) and try again."};return{verified:!1,error:n.message||"Failed to verify bank account. Please try again."}}};var I=a(5975),F=a(3973),B=a(114);let T=c.Ry({bank_account_name:c.Z_().min(2,"Account name is required"),bank_account_number:c.Z_().regex(/^\d{10}$/,"Account number must be 10 digits"),bank_name:c.Z_().min(2,"Bank name is required"),bank_code:c.Z_().min(3,"Bank code is required")});var O=!0,z=()=>{let{profile:e}=j(),n=(0,l.NL)(),[a,t]=(0,o.useState)(!1),[c,m]=(0,o.useState)(null),[b,_]=(0,o.useState)(!1),[f,v]=(0,o.useState)(null),[k,x]=(0,o.useState)([]),[p,w]=(0,o.useState)(!0),{data:N,isLoading:A}=(0,d.a)({queryKey:["creator-profile",null==e?void 0:e.id],queryFn:()=>S(e.id),enabled:!!(null==e?void 0:e.id)});(0,o.useEffect)(()=>{(async()=>{w(!0),m(null);try{let e=await P();console.log("Fetched banks:",e),e&&e.length>0?x(e):(console.warn("No banks returned from API"),m("No banks available. The Edge Function may not be deployed yet."))}catch(e){console.error("Failed to fetch banks:",e),m(e.message||"Failed to load banks")}finally{w(!1)}})()},[]);let O=(0,u.D)({mutationFn:n=>E(e.id,{bank_account_name:n.bank_account_name,bank_account_number:n.bank_account_number,bank_name:n.bank_name,bank_code:n.bank_code,is_bank_verified:n.is_bank_verified}),onSuccess:()=>{t(!0),m(null),_(!1),v(null),n.invalidateQueries({queryKey:["creator-profile",null==e?void 0:e.id]}),setTimeout(()=>t(!1),3e3)},onError:e=>{m(e.message||"Failed to update bank account"),t(!1),_(!1)}}),{register:z,handleSubmit:L,watch:Z,formState:{errors:J},reset:R}=(0,i.cI)({resolver:(0,s.F)(T),defaultValues:{bank_account_name:(null==N?void 0:N.bank_account_name)||"",bank_account_number:(null==N?void 0:N.bank_account_number)||"",bank_name:(null==N?void 0:N.bank_name)||"",bank_code:(null==N?void 0:N.bank_code)||""}});(0,o.useEffect)(()=>{N&&R({bank_account_name:N.bank_account_name||"",bank_account_number:N.bank_account_number||"",bank_name:N.bank_name||"",bank_code:N.bank_code||""})},[N,R]);let q=e=>{let n=k.find(n=>n.name===e.target.value);n&&R({bank_account_name:(null==N?void 0:N.bank_account_name)||"",bank_account_number:(null==N?void 0:N.bank_account_number)||"",bank_name:n.name,bank_code:n.code},{keepValues:!0})},V=async()=>{let e={bank_account_name:(null==N?void 0:N.bank_account_name)||"",bank_account_number:(null==N?void 0:N.bank_account_number)||"",bank_name:(null==N?void 0:N.bank_name)||"",bank_code:(null==N?void 0:N.bank_code)||""};if(!e.bank_code||!e.bank_account_number){m("Please fill in bank code and account number first");return}_(!0),m(null),v(null);try{let n=await C({account_number:e.bank_account_number,bank_code:e.bank_code});n.verified&&n.account_name?(v(n.account_name),e.bank_account_name&&e.bank_account_name.toLowerCase()!==n.account_name.toLowerCase()?m("Account name mismatch. Expected: ".concat(n.account_name)):R({...e,bank_account_name:n.account_name})):m(n.error||"Account verification failed")}catch(e){m(e.message||"Failed to verify account")}finally{_(!1)}},Y=async e=>{_(!0),m(null);try{let n=await C({account_number:e.bank_account_number,bank_code:e.bank_code});if(!n.verified){m(n.error||"Account verification failed. Please check your details."),_(!1);return}if(n.account_name&&n.account_name.toLowerCase()!==e.bank_account_name.toLowerCase()){m("Account name mismatch. The account name should be: ".concat(n.account_name)),_(!1);return}O.mutate({...e,is_bank_verified:!0})}catch(e){m(e.message||"Failed to verify account"),_(!1)}};return A?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"text-center text-muted-foreground",children:"Loading..."})}):(0,r.jsxs)("div",{className:"p-6 space-y-6 max-w-2xl",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Settings"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage your account and payout details"})]}),(0,r.jsxs)("div",{className:"bg-card rounded-2xl border border-border p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-1",children:"Bank Account Details"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add your bank account details to receive payouts from ticket sales"})]}),(null==N?void 0:N.is_bank_verified)&&(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 text-green-600 rounded-lg",children:[(0,r.jsx)(I.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Bank account verified"})]}),a&&(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 text-green-600 rounded-lg",children:[(0,r.jsx)(I.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"text-sm",children:"Bank account details updated successfully!"})]}),c&&(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-destructive/10 text-destructive rounded-lg",children:[(0,r.jsx)(F.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"text-sm",children:c})]}),f&&(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-blue-500/10 text-blue-600 rounded-lg",children:[(0,r.jsx)(I.Z,{className:"w-5 h-5"}),(0,r.jsxs)("span",{className:"text-sm",children:["Account verified: ",(0,r.jsx)("strong",{children:f})]})]}),(0,r.jsxs)("form",{onSubmit:L(Y),className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(y,{htmlFor:"bank_name",children:"Bank Name"}),p?(0,r.jsx)("div",{className:"mt-2 w-full px-3 py-2 rounded-lg border border-border bg-muted animate-pulse",children:"Loading banks..."}):0===k.length?(0,r.jsxs)("div",{className:"mt-2 w-full px-3 py-2 rounded-lg border border-border bg-muted text-muted-foreground",children:["No banks available. ",c||"Please check your connection."]}):(0,r.jsxs)("select",{id:"bank_name",...z("bank_name"),onChange:e=>{z("bank_name").onChange(e),q(e)},className:"mt-2 w-full px-3 py-2 rounded-lg border border-border bg-background",children:[(0,r.jsx)("option",{value:"",children:"Select a bank"}),k.map(e=>(0,r.jsx)("option",{value:e.name,children:e.name},e.code))]}),J.bank_name&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:J.bank_name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y,{htmlFor:"bank_code",children:"Bank Code"}),(0,r.jsx)(g,{id:"bank_code",type:"text",placeholder:"Bank code (auto-filled)",...z("bank_code"),readOnly:!0,className:"mt-2"}),J.bank_code&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:J.bank_code.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y,{htmlFor:"bank_account_name",children:"Account Name"}),(0,r.jsx)(g,{id:"bank_account_name",type:"text",placeholder:"John Doe",...z("bank_account_name"),className:"mt-2"}),J.bank_account_name&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:J.bank_account_name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y,{htmlFor:"bank_account_number",children:"Account Number"}),(0,r.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,r.jsx)(g,{id:"bank_account_number",type:"text",placeholder:"1234567890",maxLength:10,...z("bank_account_number"),className:"flex-1"}),(0,r.jsx)(h,{type:"button",variant:"outline",onClick:V,disabled:b||!Z("bank_code")||!Z("bank_account_number"),className:"gap-2",children:b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.Z,{className:"w-4 h-4 animate-spin"}),"Verifying..."]}):"Verify"})]}),J.bank_account_number&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:J.bank_account_number.message})]}),(0,r.jsx)(h,{type:"submit",variant:"hero",disabled:O.isPending||b,className:"w-full",children:O.isPending?"Saving...":"Save Bank Details"})]})]})]})}}},function(e){e.O(0,[966,888,774,179],function(){return e(e.s=2803)}),_N_E=e.O()}]);