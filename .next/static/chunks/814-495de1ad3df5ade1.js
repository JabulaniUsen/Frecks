"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{9174:function(e,t,r){r.d(t,{C:function(){return s}});var a=r(7437);r(2265);var n=r(535),i=r(3448);let o=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function s(e){let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{className:(0,i.cn)(o({variant:r}),t),...n})}},279:function(e,t,r){r.d(t,{I:function(){return o}});var a=r(7437),n=r(2265),i=r(3448);let o=n.forwardRef((e,t)=>{let{className:r,type:n,...o}=e;return(0,a.jsx)("input",{type:n,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...o})});o.displayName="Input"},5060:function(e,t,r){r.d(t,{_:function(){return d}});var a=r(7437),n=r(2265),i=r(6394),o=r(535),s=r(3448);let c=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(i.f,{ref:t,className:(0,s.cn)(c(),r),...n})});d.displayName=i.f.displayName},5658:function(e,t,r){r.d(t,{G5:function(){return c},Uc:function(){return o},Wb:function(){return s},m5:function(){return u},s4:function(){return d}});var a,n=r(257);let i=(void 0!==n?null===(a=n.env)||void 0===a?void 0:"pk_test_305a29a2af6419e97f6aaf29d62c648d334d8a1c":void 0)||"";i||console.warn("Paystack public key is not set. Payment functionality will not work.");let o=()=>{if(!window.PaystackPop&&i){let e=document.createElement("script");return e.src="https://js.paystack.co/v1/inline.js",e.async=!0,document.head.appendChild(e),new Promise(t=>{e.onload=()=>t()})}return Promise.resolve()},s=e=>{if(!window.PaystackPop){console.error("Paystack not loaded");return}window.PaystackPop.setup({key:i,email:e.email,amount:100*e.amount,ref:e.ref,currency:e.currency||"NGN",metadata:e.metadata,callback:t=>{e.callback&&e.callback(t)},onClose:()=>{e.onClose&&e.onClose()}}).openIframe()},c=async()=>{try{try{let e=await fetch("/api/get-banks",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP error! status: ".concat(e.status))}let t=await e.json();if(t.error)throw Error(t.error);let r=t.banks||[];return console.log("Banks from API route:",r.length,"banks"),0===r.length&&console.warn("Empty banks array returned"),r}catch(i){console.warn("API route failed, trying edge function:",i.message);let{supabase:e}=await Promise.resolve().then(r.bind(r,5526)),{data:{session:t}}=await e.auth.getSession(),{data:a,error:n}=await e.functions.invoke("get-paystack-banks",{headers:{Authorization:t?"Bearer ".concat(t.access_token):""}});if(n)throw n;if(!a)throw Error("No response from bank service");if(a.error)throw Error(a.error);return a.banks||[]}}catch(t){console.error("Error fetching banks:",t);let e=t.message||JSON.stringify(t);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))throw Error("Bank service is not available. Please check your environment variables (PAYSTACK_SECRET_KEY) and try again.");throw Error(t.message||"Failed to fetch banks. Please try again.")}},d=async e=>{try{if(!e.account_number||!e.bank_code)return{verified:!1,error:"Account number and bank code are required"};if(10!==e.account_number.length)return{verified:!1,error:"Account number must be exactly 10 digits"};try{let t=await fetch("/api/verify-bank-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"HTTP error! status: ".concat(t.status))}let r=await t.json();if(r.error)return{verified:!1,error:r.error};return{verified:r.verified||!1,account_name:r.account_name,account_number:r.account_number,bank_id:r.bank_id}}catch(o){console.warn("API route failed, trying edge function:",o.message);let{supabase:t}=await Promise.resolve().then(r.bind(r,5526)),{data:{session:a}}=await t.auth.getSession(),{data:n,error:i}=await t.functions.invoke("verify-bank-account",{body:e,headers:{Authorization:a?"Bearer ".concat(a.access_token):""}});if(i)throw i;if(!n)return{verified:!1,error:"No response from verification service"};if(n.error)return{verified:!1,error:n.error};return{verified:n.verified||!1,account_name:n.account_name,account_number:n.account_number,bank_id:n.bank_id}}}catch(t){console.error("Bank verification error:",t);let e=t.message||JSON.stringify(t);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))return{verified:!1,error:"Bank verification service is not available. Please check your environment variables (PAYSTACK_SECRET_KEY) and try again."};return{verified:!1,error:t.message||"Failed to verify bank account. Please try again."}}},u=async(e,t)=>{try{try{let r=await fetch("/api/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,paystackReference:t})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"HTTP error! status: ".concat(r.status))}return await r.json()}catch(s){console.warn("API route failed, trying edge function:",s.message);let{supabase:a}=await Promise.resolve().then(r.bind(r,5526)),{data:{session:n}}=await a.auth.getSession(),{data:i,error:o}=await a.functions.invoke("verify-payment",{body:{orderId:e,paystackReference:t},headers:{Authorization:n?"Bearer ".concat(n.access_token):"","Content-Type":"application/json"}});if(o)throw o;if(!i)throw Error("No response from verification service");return i}}catch(t){console.error("Payment verification error:",t);let e=t.message||JSON.stringify(t);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))return{verified:!1,error:"Payment verification service error. Please check your environment variables (PAYSTACK_SECRET_KEY, SUPABASE_SERVICE_ROLE_KEY) and try again."};return{verified:!1,error:t.message||"Failed to verify payment. Please try again."}}}},1980:function(e,t,r){r.d(t,{Bt:function(){return o},D0:function(){return c},LV:function(){return s},Lj:function(){return u},eJ:function(){return i},li:function(){return d},yM:function(){return n}});var a=r(5526);let n=async e=>{console.log("Creating event in database...",{creator_id:e.creator_id,title:e.title,category:e.category});let{data:t,error:r}=await a.supabase.from("events").insert({creator_id:e.creator_id,title:e.title,description:e.description,category:e.category,image_url:e.image_url,date:e.date,location:e.location,is_featured:e.is_featured||!1,status:"active"}).select().single();if(r)throw console.error("Event creation error:",r),Error("Failed to create event: ".concat(r.message," (").concat(r.code||"unknown",")"));if(!t)throw Error("Event creation returned no data");console.log("Event created, ID:",t.id),console.log("Creating ticket types...",e.ticket_types.length);let n=e.ticket_types.map(e=>({event_id:t.id,name:e.name,description:e.description,price:e.price,quantity:e.quantity,is_free:e.is_free||!1})),{error:i}=await a.supabase.from("ticket_types").insert(n);if(i)throw console.error("Ticket types creation error:",i),Error("Failed to create ticket types: ".concat(i.message," (").concat(i.code||"unknown",")"));return console.log("Ticket types created successfully"),t},i=async(e,t)=>{let{data:r,error:n}=await a.supabase.from("events").update({title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured||!1,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw Error("Failed to update event: ".concat(n.message));if(!r)throw Error("Event update returned no data");let{data:i}=await a.supabase.from("ticket_types").select("id").eq("event_id",e),o=new Set((null==i?void 0:i.map(e=>e.id))||[]),s=new Set(t.ticket_types.filter(e=>e.id).map(e=>e.id)),c=Array.from(o).filter(e=>!s.has(e));for(let r of(c.length>0&&await a.supabase.from("ticket_types").delete().in("id",c),t.ticket_types))r.id&&o.has(r.id)?await a.supabase.from("ticket_types").update({name:r.name,description:r.description,price:r.price,quantity:r.quantity,is_free:r.is_free||!1}).eq("id",r.id):await a.supabase.from("ticket_types").insert({event_id:e,name:r.name,description:r.description,price:r.price,quantity:r.quantity,is_free:r.is_free||!1});return r},o=async(e,t)=>{let{data:r,error:n}=await a.supabase.from("events").select("*").eq("id",e).eq("creator_id",t).single();if(n)throw n;if(!r)throw Error("Event not found or access denied");let{error:i}=await a.supabase.from("deleted_events").insert({original_event_id:r.id,creator_id:r.creator_id,title:r.title,description:r.description,category:r.category,image_url:r.image_url,date:r.date,location:r.location,is_featured:r.is_featured,status:"cancelled",deleted_by:t,created_at:r.created_at,updated_at:r.updated_at});if(i)throw i;let{error:o}=await a.supabase.from("events").delete().eq("id",e).eq("creator_id",t);if(o)throw o;return{success:!0}},s=async e=>{let{data:t,error:r}=await a.supabase.from("orders").insert({user_id:e.user_id,event_id:e.event_id,email:e.email,full_name:e.full_name,total_amount:e.total_amount,paystack_reference:e.paystack_reference,payment_status:e.payment_status||"pending"}).select().single();if(r)throw r;let n=e.tickets.map(r=>({ticket_type_id:r.ticket_type_id,event_id:e.event_id,user_id:e.user_id,order_id:t.id,qr_code:r.qr_code,qr_code_data:r.qr_code_data,status:(e.payment_status,"valid")})),{error:i}=await a.supabase.from("tickets").insert(n);if(i)throw i;if("paid"===e.payment_status){let t=new Map;for(let r of e.tickets){let e=t.get(r.ticket_type_id)||0;t.set(r.ticket_type_id,e+1)}for(let[e,r]of t){let{data:t}=await a.supabase.from("ticket_types").select("sold_count").eq("id",e).single();t&&await a.supabase.from("ticket_types").update({sold_count:t.sold_count+r}).eq("id",e)}}return t},c=async(e,t)=>{let{data:r,error:n}=await a.supabase.from("creator_profiles").upsert({user_id:e,...t}).select().single();if(n)throw n;return r},d=async(e,t)=>{var r;let{data:n,error:i}=await a.supabase.from("tickets").select("*, event:events!inner(creator_id, id)").eq("id",e).single();if(i||!n)throw Error("Ticket not found");if((null===(r=n.event)||void 0===r?void 0:r.creator_id)!==t)throw Error("Only the event creator can validate tickets");if("used"===n.status)throw Error("Ticket has already been validated");if("cancelled"===n.status)throw Error("Ticket has been cancelled");let{error:o}=await a.supabase.from("tickets").update({status:"used",checked_in_at:new Date().toISOString(),checked_in_by:t}).eq("id",e);if(o)throw Error("Failed to validate ticket: ".concat(o.message));return await a.supabase.from("qr_scans").insert({ticket_id:e,scanned_by:t,scan_result:"valid"}),{success:!0,ticketId:e}},u=async(e,t)=>{let{data:r,error:n}=await a.supabase.from("users").update({full_name:t.full_name,gender:t.gender,school:t.school,avatar_name:t.avatar_name,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw n;return r}},6629:function(e,t,r){r.d(t,{DK:function(){return l},HG:function(){return s},Q6:function(){return p},Qn:function(){return c},TX:function(){return u},Y:function(){return o},ZD:function(){return d},ks:function(){return f},nk:function(){return i},vw:function(){return n}});var a=r(5526);let n=async()=>{let e=new Date().toISOString(),{data:t,error:r}=await a.supabase.from("events").select("*, ticket_types(*)").eq("status","active").gte("date",e).order("created_at",{ascending:!1});if(r)throw r;return t},i=async e=>{let t=new Date().toISOString(),r=a.supabase.from("events").select("*, ticket_types(*)").eq("status","active").gte("date",t);if(e.search&&e.search.trim()){let t=e.search.trim().replace(/%/g,"\\%").replace(/_/g,"\\_");r=r.or("title.ilike.%".concat(t,"%,description.ilike.%").concat(t,"%"))}e.category&&"all"!==e.category&&(r=r.eq("category",e.category)),e.location&&e.location.trim()&&(r=r.ilike("location","%".concat(e.location,"%"))),e.dateFrom&&(r=r.gte("date",e.dateFrom)),e.dateTo&&(r=r.lte("date",e.dateTo)),r=r.order("date",{ascending:!0});let{data:n,error:i}=await r;if(i)throw i;return n},o=async e=>{let{data:t,error:r}=await a.supabase.from("events").select("*, ticket_types(*)").eq("id",e).single();if(r)throw r;return t},s=async e=>{let{data:t,error:r}=await a.supabase.from("orders").select("*, event:events(*), tickets(*, ticket_type:ticket_types(*))").eq("id",e).single();if(r)throw r;return t},c=async e=>{let{data:t,error:r}=await a.supabase.from("tickets").select("*, event:events(*), ticket_type:ticket_types(*)").eq("id",e).single();if(r)throw r;return t},d=async e=>{let{data:t,error:r}=await a.supabase.from("orders").select("id").eq("user_id",e).eq("payment_status","paid");if(r)throw r;if(!t||0===t.length)return[];let n=t.map(e=>e.id),{data:i,error:o}=await a.supabase.from("tickets").select("*, event:events(*), ticket_type:ticket_types(*), order:orders(*)").eq("user_id",e).in("order_id",n).order("created_at",{ascending:!1});if(o)throw o;return i||[]},u=async e=>{let t=new Date().toISOString(),{data:r,error:n}=await a.supabase.from("events").select("*, ticket_types(*)").eq("creator_id",e).gte("date",t).order("date",{ascending:!0});if(n)throw n;return r},l=async e=>{let t=new Date().toISOString(),{data:r,error:n}=await a.supabase.from("events").select("*, ticket_types(*)").eq("creator_id",e).lt("date",t).order("date",{ascending:!1});if(n)throw n;return r},f=async e=>{let{data:t,error:r}=await a.supabase.from("creator_profiles").select("*").eq("user_id",e).maybeSingle();if(r)throw r;return t||null},p=async e=>{let{data:t,error:r}=await a.supabase.from("orders").select("*, tickets(*)").eq("event_id",e).eq("payment_status","paid");if(r)throw r;let{data:n,error:i}=await a.supabase.from("tickets").select("*, ticket_type:ticket_types(*)").eq("event_id",e);if(i)throw i;return{orders:t||[],tickets:n||[]}}}}]);