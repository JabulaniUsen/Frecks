(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[679],{69013:function(e,s,r){Promise.resolve().then(r.bind(r,53685))},53685:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return k}});var t=r(57437),a=r(2265),i=r(99376),n=r(27648),d=r(11713),l=r(12381),c=r(69174),o=r(82023),m=r(51817),u=r(95080),x=r(31047),f=r(83774),h=r(92735),v=r(88361),g=r(14362),p=r(96629),j=r(64014),b=r(5526),N=r(14438),w=r(29827),y=r(21770);function k(){let{profile:e,loading:s,user:r,refreshProfile:k}=(0,g.a)(),_=(0,i.useRouter)(),E=(0,w.NL)(),{data:q,isLoading:z}=(0,d.a)({queryKey:["user-tickets",null==r?void 0:r.id],queryFn:()=>(0,p.ZD)(r.id),enabled:!!(null==r?void 0:r.id)&&!s}),C=(0,y.D)({mutationFn:async()=>{if(!(null==r?void 0:r.id))throw Error("User not authenticated");let{error:e}=await b.supabase.from("users").update({role:"creator"}).eq("id",r.id);if(e)throw e;let{data:s}=await b.supabase.from("creator_profiles").select("id").eq("user_id",r.id).maybeSingle();if(!s){let{error:e}=await b.supabase.from("creator_profiles").insert({user_id:r.id});if(e)throw e}await k()},onSuccess:()=>{N.Am.success("You are now an event organizer!"),E.invalidateQueries({queryKey:["user-tickets"]}),_.push("/dashboard/creator")},onError:e=>{N.Am.error((null==e?void 0:e.message)||"Failed to become event organizer")}});return((0,a.useEffect)(()=>{if(!s){if(!r||!e){_.replace("/auth/signin?redirect=/dashboard/user");return}if("creator"===e.role){_.replace("/dashboard/creator");return}}},[e,s,r,_]),s)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}):r&&e&&"user"===e.role?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,t.jsx)(v.default,{}),(0,t.jsx)("main",{className:"flex-1 pt-20",children:(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"My Tickets"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Welcome back, ",(null==e?void 0:e.full_name)||"User","! Here are your tickets."]})]}),(0,t.jsxs)(l.z,{variant:"outline",onClick:()=>C.mutate(),disabled:C.isPending,className:"gap-2 shrink-0",children:[(0,t.jsx)(o.Z,{className:"w-4 h-4"}),C.isPending?"Upgrading...":"Become Event Organizer"]})]}),z?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(m.Z,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading your tickets..."})]}):q&&0!==q.length?(0,t.jsx)("div",{className:"grid gap-3",children:q.map(e=>{var s,r;let a=e.event,i=e.ticket_type,d=(null===(s=e.qr_code_data)||void 0===s?void 0:s.qrCodeImageUrl)||(null===(r=e.qr_code_data)||void 0===r?void 0:r.qrCodeImage);return(0,t.jsx)("div",{className:"bg-card rounded-xl border border-border p-4 md:p-6 hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"flex gap-3 md:gap-4",children:[(null==a?void 0:a.image_url)&&(0,t.jsx)("div",{className:"w-20 h-20 md:w-32 md:h-32 rounded-lg overflow-hidden bg-muted shrink-0",children:(0,t.jsx)("img",{src:a.image_url,alt:a.title,className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("h3",{className:"text-base md:text-xl font-bold mb-1 truncate",children:(null==a?void 0:a.title)||"Event"}),(0,t.jsx)(c.C,{className:"text-xs",children:(null==a?void 0:a.category)||"Event"})]}),(0,t.jsx)(c.C,{variant:"valid"===e.status?"default":"used"===e.status?"secondary":"destructive",className:"shrink-0 text-xs",children:"valid"===e.status?"Valid":"used"===e.status?"Used":"Cancelled"})]}),(0,t.jsxs)("div",{className:"space-y-1.5 mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[(0,t.jsx)(x.Z,{className:"w-3 h-3 md:w-4 md:h-4 shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:(null==a?void 0:a.date)?(0,j.WU)(new Date(a.date),"MMM d, yyyy • h:mm a"):"Date TBD"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[(0,t.jsx)(f.Z,{className:"w-3 h-3 md:w-4 md:h-4 shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:(null==a?void 0:a.location)||"Location TBD"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pt-3 border-t border-border",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Ticket Type"}),(0,t.jsx)("p",{className:"text-sm md:text-base font-semibold",children:(null==i?void 0:i.name)||"General Admission"}),(null==i?void 0:i.price)!==void 0&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:i.is_free?"Free":"₦".concat(i.price)})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.default,{href:"/invoice/".concat(e.order_id),className:"flex-1 sm:flex-initial",children:(0,t.jsx)(l.z,{variant:"outline",size:"sm",className:"w-full sm:w-auto text-xs",children:"See Ticket"})}),d&&(0,t.jsx)(n.default,{href:"/invoice/".concat(e.order_id),className:"flex-1 sm:flex-initial",children:(0,t.jsxs)(l.z,{variant:"hero",size:"sm",className:"w-full sm:w-auto gap-2 text-xs",children:[(0,t.jsx)(h.Z,{className:"w-3 h-3 md:w-4 md:h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Download"})]})})]})]})]})]})},e.id)})}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(u.Z,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"No tickets yet"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Start exploring events and get your tickets!"}),(0,t.jsx)(n.default,{href:"/",children:(0,t.jsx)(l.z,{variant:"hero",children:"Browse Events"})})]})]})})]}):null}},69174:function(e,s,r){"use strict";r.d(s,{C:function(){return d}});var t=r(57437);r(2265);var a=r(90535),i=r(93448);let n=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:s,variant:r,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)(n({variant:r}),s),...a})}}},function(e){e.O(0,[3227,4182,2972,5506,2642,3850,5730,758,5256,2893,1713,4438,7060,9913,8361,2971,2117,1744],function(){return e(e.s=69013)}),_N_E=e.O()}]);