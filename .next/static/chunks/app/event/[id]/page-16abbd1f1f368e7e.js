(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9744],{5906:function(e,t,r){Promise.resolve().then(r.bind(r,32634))},32634:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return T}});var a=r(57437),s=r(27648),i=r(2265),n=r(11713),o=r(21770),c=r(99376),d=r(12381),l=r(69174),u=r(40279),m=r(75060),f=r(32660),p=r(31047),h=r(83774),x=r(95805),b=r(91723),g=r(21047),y=r(99397),v=r(84286),w=r(51817),_=r(96629),j=r(61980),N=r(25658),k=r(35819),E=r(5526);let S=async e=>{let t=e.validationUrl||"".concat(window.location.origin,"/ticket/").concat(e.ticketId);try{return await k.toDataURL(t,{errorCorrectionLevel:"M",type:"image/png",margin:1,width:300})}catch(e){throw console.error("Error generating QR code:",e),e}},q=async(e,t)=>{try{let s=await S(e),i=await fetch(s),n=await i.blob(),o=new File([n],"qr-".concat(e.ticketId,".png"),{type:"image/png"}),c="".concat(t,"/").concat(e.ticketId,".png"),{data:d,error:l}=await E.supabase.storage.from("ticket-qr").upload(c,o,{cacheControl:"3600",upsert:!0});if(l){var r,a;if(null===(r=l.message)||void 0===r?void 0:r.includes("Bucket not found"))throw Error('Storage bucket "ticket-qr" not found. Please create it in your Supabase dashboard.');if(null===(a=l.message)||void 0===a?void 0:a.includes("new row violates row-level security"))throw Error("Permission denied. Please check storage bucket policies.");throw Error("QR code upload failed: ".concat(l.message))}if(!d)throw Error("Upload succeeded but no data returned");let{data:u}=E.supabase.storage.from("ticket-qr").getPublicUrl(c);if(!(null==u?void 0:u.publicUrl))throw Error("Failed to get public URL for uploaded QR code");return u.publicUrl}catch(e){throw console.error("Error generating and uploading QR code:",e),e}};var P=r(14362),C=r(64014),I=r(88361),A=r(92834),F=r(14438);function T(){let e=(0,c.useParams)(),t=(0,c.useRouter)(),r=e.id,{user:k,profile:T}=(0,P.a)(),{data:D,isLoading:O,error:R}=(0,n.a)({queryKey:["event",r],queryFn:()=>(0,_.Y)(r),enabled:!!r}),[L,Z]=(0,i.useState)({}),[B,M]=(0,i.useState)("select"),[U,z]=(0,i.useState)(""),[Y,J]=(0,i.useState)(""),[K,W]=(0,i.useState)(!1),[H,V]=(0,i.useState)(!1),Q=(null==D?void 0:D.ticket_types)||[],G=Object.entries(L).reduce((e,t)=>{let[r,a]=t,s=Q.find(e=>e.id===r);return e+((null==s?void 0:s.price)||0)*a},0),$=G+200,X=Q.reduce((e,t)=>e+(t.sold_count||0),0),ee=Object.values(L).reduce((e,t)=>e+t,0);(0,i.useEffect)(()=>{(0,N.Uc)().then(()=>{V(!0)})},[]),(0,i.useEffect)(()=>{"checkout"===B&&T&&(T.full_name&&!U.trim()&&z(T.full_name),T.email&&!Y.trim()&&J(T.email))},[B,T]);let et=(0,o.D)({mutationFn:async()=>{if(!U.trim()||!Y.trim())throw Error("Please fill in your name and email");if(0===ee)throw Error("Please select at least one ticket");let e="frecks_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(7)),t=[];for(let[e,a]of Object.entries(L))for(let s=0;s<a;s++){let a={ticketId:"temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(7)),orderId:"",eventId:r,timestamp:Date.now()},i=await S(a),n="".concat(r,"_").concat(e,"_").concat(Date.now(),"_").concat(s,"_").concat(Math.random().toString(36).substring(7));t.push({ticket_type_id:e,qr_code:n,qr_code_data:{...a,qrCodeImage:i}})}let a=await (0,j.LV)({user_id:null==k?void 0:k.id,event_id:r,email:Y.trim(),full_name:U.trim(),total_amount:$,paystack_reference:e,payment_status:"pending",tickets:t});if(a.id){let{data:e}=await E.supabase.from("tickets").select("id, ticket_type_id, user_id").eq("order_id",a.id).order("created_at",{ascending:!0});if(e&&e.length===t.length)for(let t=0;t<e.length;t++){let s=e[t],i=window.location.origin,n="".concat(i,"/ticket/").concat(s.id),o={ticketId:s.id,orderId:a.id,eventId:r,timestamp:Date.now(),validationUrl:n},c=s.user_id||"guest",d=await q(o,c);await E.supabase.from("tickets").update({qr_code:s.id,qr_code_data:{...o,qrCodeImageUrl:d}}).eq("id",s.id)}}return{order:a,paystackReference:e}}}),er=(0,o.D)({mutationFn:async e=>{let{orderId:t,paystackReference:r}=e,a=await (0,N.m5)(t,r);if(!a.verified)throw Error(a.error||"Payment verification failed");return a}});if(O)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center",children:"Loading event..."})});if(R||!D)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Event not found"}),(0,a.jsx)(s.default,{href:"/",children:(0,a.jsx)(d.z,{children:"Back to Home"})})]})});let ea=(e,t)=>{Z(r=>{let a=Math.max(0,Math.min(10,(r[e]||0)+t));if(0===a){let{[e]:t,...a}=r;return a}return{...r,[e]:a}})},es=async()=>{if(!U.trim()||!Y.trim()){F.Am.error("Please fill in your name and email");return}if(!H){F.Am.error("Payment system is loading. Please wait a moment.");return}W(!0),M("processing");try{let e=await et.mutateAsync(),a=e.order,s=e.paystackReference;(0,N.Wb)({email:Y.trim(),amount:$,ref:s,metadata:{orderId:a.id,eventId:r,custom_fields:[{display_name:"Full Name",variable_name:"full_name",value:U.trim()}]},callback:async e=>{try{await er.mutateAsync({orderId:a.id,paystackReference:e.reference}),t.push("/invoice/".concat(a.id))}catch(e){console.error("Payment verification error:",e),F.Am.error((null==e?void 0:e.message)||"Payment verification failed. Please contact support."),M("checkout")}finally{W(!1)}},onClose:()=>{W(!1),M("checkout"),F.Am.info("Payment cancelled")}})}catch(e){console.error("Order creation error:",e),F.Am.error((null==e?void 0:e.message)||"Failed to create order. Please try again."),W(!1),M("checkout")}};return(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)(I.default,{}),(0,a.jsxs)("main",{className:"pt-20",children:[(0,a.jsxs)("div",{className:"relative h-64 md:h-96 overflow-hidden",children:[(0,a.jsx)("img",{src:D.image_url||"https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=800&h=600&fit=crop",alt:D.title,className:"w-full h-full object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/50 to-transparent"}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-6",children:(0,a.jsx)("div",{className:"container mx-auto",children:(0,a.jsxs)(s.default,{href:"/",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground mb-4 transition-colors",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"}),"Back to Events"]})})})]}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2",children:[(0,a.jsx)(l.C,{className:"bg-primary text-primary-foreground mb-4",children:D.category}),(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-bold mb-6",children:D.title}),(0,a.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-card rounded-xl border border-border",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,a.jsx)(p.Z,{className:"w-6 h-6 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Date & Time"}),(0,a.jsx)("div",{className:"font-semibold",children:(0,C.WU)(new Date(D.date),"EEE, MMM d, yyyy • h:mm a")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-card rounded-xl border border-border",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"w-6 h-6 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Location"}),(0,a.jsx)("div",{className:"font-semibold",children:D.location})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-card rounded-xl border border-border",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,a.jsx)(x.Z,{className:"w-6 h-6 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Attendees"}),(0,a.jsxs)("div",{className:"font-semibold",children:[X," going"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-card rounded-xl border border-border",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,a.jsx)(b.Z,{className:"w-6 h-6 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Duration"}),(0,a.jsx)("div",{className:"font-semibold",children:"3-4 hours"})]})]})]}),(0,a.jsxs)("div",{className:"prose prose-lg max-w-none",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"About This Event"}),(0,a.jsx)("p",{className:"text-muted-foreground whitespace-pre-line",children:D.description||"Join us for an unforgettable experience at ".concat(D.title,"! This event brings together students from across the university for an amazing time filled with entertainment, networking, and fun.")})]})]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"sticky top-24 bg-card rounded-2xl border border-border shadow-card overflow-hidden",children:["select"===B&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-6 border-b border-border",children:(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Select Tickets"})}),(0,a.jsx)("div",{className:"p-6 space-y-4",children:0===Q.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No tickets available for this event."}):Q.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-background rounded-xl border border-border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,a.jsx)("div",{className:"text-lg font-bold text-primary",children:e.is_free?"Free":"₦".concat(e.price)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 mt-3",children:[(0,a.jsx)("button",{onClick:()=>ea(e.id,-1),className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center hover:bg-muted/80 transition-colors",children:(0,a.jsx)(g.Z,{className:"w-4 h-4"})}),(0,a.jsx)("span",{className:"w-8 text-center font-semibold",children:L[e.id]||0}),e.quantity&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["/ ",e.quantity-(e.sold_count||0)," left"]}),(0,a.jsx)("button",{onClick:()=>ea(e.id,1),className:"w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center hover:brightness-110 transition-all",children:(0,a.jsx)(y.Z,{className:"w-4 h-4"})})]})]},e.id))}),(0,a.jsxs)("div",{className:"p-6 border-t border-border bg-muted/30",children:[(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-muted-foreground",children:["Subtotal (",ee," ",1===ee?"ticket":"tickets",")"]}),(0,a.jsxs)("span",{className:"font-medium",children:["₦",G.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Service Charge"}),(0,a.jsxs)("span",{className:"font-medium",children:["₦",200..toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-2 border-t border-border",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Total"}),(0,a.jsxs)("span",{className:"text-2xl font-bold",children:["₦",$.toLocaleString()]})]})]}),(0,a.jsx)(d.z,{variant:"hero",className:"w-full",size:"lg",onClick:()=>{ee>0&&M("checkout")},disabled:0===ee,children:"Continue to Checkout"})]})]}),"checkout"===B&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-6 border-b border-border",children:[(0,a.jsxs)("button",{onClick:()=>M("select"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground mb-2",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"}),"Back"]}),(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Checkout"})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(m._,{htmlFor:"fullName",children:"Full Name *"}),(0,a.jsx)(u.I,{id:"fullName",type:"text",placeholder:"John Doe",value:U,onChange:e=>z(e.target.value),className:"mt-2",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m._,{htmlFor:"email",children:"Email *"}),(0,a.jsx)(u.I,{id:"email",type:"email",placeholder:"john@university.edu",value:Y,onChange:e=>J(e.target.value),className:"mt-2",required:!0})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground p-3 bg-muted/50 rounded-lg",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 text-primary"}),"Your payment is processed securely by Paystack"]})]}),(0,a.jsxs)("div",{className:"p-6 border-t border-border bg-muted/30",children:[(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-medium",children:["₦",G.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Service Charge"}),(0,a.jsxs)("span",{className:"font-medium",children:["₦",200..toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-2 border-t border-border",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Total"}),(0,a.jsxs)("span",{className:"text-2xl font-bold",children:["₦",$.toLocaleString()]})]})]}),(0,a.jsx)(d.z,{variant:"hero",className:"w-full",size:"lg",onClick:es,disabled:!U.trim()||!Y.trim()||!H||K,children:K?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):"Pay ₦".concat($.toLocaleString())})]})]}),"processing"===B&&(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(w.Z,{className:"w-10 h-10 text-primary animate-spin"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Processing Payment"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6",children:"Please complete your payment in the popup window..."})]})]})})]})})]}),(0,a.jsx)(A.Z,{})]})}},92834:function(e,t,r){"use strict";var a=r(57437),s=r(27648),i=r(33145),n=r(37760),o=r(42351),c=r(79219),d=r(74767),l=r(12381);t.Z=e=>{let{showNewsletter:t=!1}=e;return(0,a.jsxs)("footer",{id:"about",className:"bg-card border-t border-border",children:[t&&(0,a.jsx)("div",{className:"container mx-auto px-4 py-12",children:(0,a.jsxs)("div",{className:"bg-primary rounded-3xl p-8 md:p-12 text-center",children:[(0,a.jsx)("h3",{className:"text-2xl md:text-3xl font-bold text-primary-foreground mb-4",children:"Never Miss an Event! \uD83C\uDFAB"}),(0,a.jsx)("p",{className:"text-primary-foreground/80 mb-6 max-w-md mx-auto",children:"Subscribe to get notified about new events, exclusive deals, and early bird tickets."}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 max-w-md mx-auto",children:[(0,a.jsx)("input",{type:"email",placeholder:"Enter your email",className:"flex-1 px-5 py-3 rounded-full bg-primary-foreground/20 border border-primary-foreground/30 text-primary-foreground placeholder:text-primary-foreground/60 outline-none focus:ring-2 focus:ring-primary-foreground/50"}),(0,a.jsx)(l.z,{variant:"secondary",size:"lg",children:"Subscribe"})]})]})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-12",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-8",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(s.default,{href:"/",className:"flex items-center gap-2 mb-4 relative w-32 h-12",children:(0,a.jsx)(i.default,{src:"/logo.png",alt:"Frecks",fill:!0,className:"object-contain object-left"})}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6 max-w-xs",children:"Your go-to platform for discovering and booking campus events. Made by students, for students."}),(0,a.jsx)("div",{className:"flex gap-3",children:[n.Z,o.Z,c.Z,d.Z].map((e,t)=>(0,a.jsx)("a",{href:"#",className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center hover:bg-primary hover:text-primary-foreground transition-colors",children:(0,a.jsx)(e,{className:"w-5 h-5"})},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-4",children:"Company"}),(0,a.jsx)("ul",{className:"space-y-2",children:["About Us","Careers","Blog","Press"].map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:e})},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-4",children:"Support"}),(0,a.jsx)("ul",{className:"space-y-2",children:["Help Center","Safety","Terms","Privacy"].map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:e})},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-4",children:"For Venues"}),(0,a.jsx)("ul",{className:"space-y-2",children:["Partner With Us","List Your Event","Pricing","Resources"].map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:e})},e))})]})]})}),(0,a.jsx)("div",{className:"border-t border-border",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-muted-foreground",children:[(0,a.jsx)("p",{children:"\xa9 2026 Frecks. All rights reserved."}),(0,a.jsx)("p",{children:"Made with \uD83E\uDDE1 for students everywhere"})]})})})]})}},69174:function(e,t,r){"use strict";r.d(t,{C:function(){return o}});var a=r(57437);r(2265);var s=r(90535),i=r(93448);let n=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)(n({variant:r}),t),...s})}},40279:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var a=r(57437),s=r(2265),i=r(93448);let n=s.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},75060:function(e,t,r){"use strict";r.d(t,{_:function(){return d}});var a=r(57437),s=r(2265),i=r(6394),n=r(90535),o=r(93448);let c=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(i.f,{ref:t,className:(0,o.cn)(c(),r),...s})});d.displayName=i.f.displayName},25658:function(e,t,r){"use strict";r.d(t,{G5:function(){return c},Uc:function(){return n},Wb:function(){return o},m5:function(){return l},s4:function(){return d}});var a,s=r(40257);let i=(void 0!==s?null===(a=s.env)||void 0===a?void 0:"pk_test_305a29a2af6419e97f6aaf29d62c648d334d8a1c":void 0)||"";i||console.warn("Paystack public key is not set. Payment functionality will not work.");let n=()=>{if(!window.PaystackPop&&i){let e=document.createElement("script");return e.src="https://js.paystack.co/v1/inline.js",e.async=!0,document.head.appendChild(e),new Promise(t=>{e.onload=()=>t()})}return Promise.resolve()},o=e=>{if(!window.PaystackPop){console.error("Paystack not loaded");return}window.PaystackPop.setup({key:i,email:e.email,amount:100*e.amount,ref:e.ref,currency:e.currency||"NGN",metadata:e.metadata,callback:t=>{e.callback&&e.callback(t)},onClose:()=>{e.onClose&&e.onClose()}}).openIframe()},c=async()=>{try{try{let e=await fetch("/api/get-banks",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP error! status: ".concat(e.status))}let t=await e.json();if(t.error)throw Error(t.error);let r=t.banks||[];return console.log("Banks from API route:",r.length,"banks"),0===r.length&&console.warn("Empty banks array returned"),r}catch(i){console.warn("API route failed, trying edge function:",i.message);let{supabase:e}=await Promise.resolve().then(r.bind(r,5526)),{data:{session:t}}=await e.auth.getSession(),{data:a,error:s}=await e.functions.invoke("get-paystack-banks",{headers:{Authorization:t?"Bearer ".concat(t.access_token):""}});if(s)throw s;if(!a)throw Error("No response from bank service");if(a.error)throw Error(a.error);return a.banks||[]}}catch(t){console.error("Error fetching banks:",t);let e=t.message||JSON.stringify(t);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))throw Error("Bank service is not available. Please check your environment variables (PAYSTACK_SECRET_KEY) and try again.");throw Error(t.message||"Failed to fetch banks. Please try again.")}},d=async e=>{try{if(!e.account_number||!e.bank_code)return{verified:!1,error:"Account number and bank code are required"};if(10!==e.account_number.length)return{verified:!1,error:"Account number must be exactly 10 digits"};try{let t=await fetch("/api/verify-bank-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"HTTP error! status: ".concat(t.status))}let r=await t.json();if(r.error)return{verified:!1,error:r.error};return{verified:r.verified||!1,account_name:r.account_name,account_number:r.account_number,bank_id:r.bank_id}}catch(n){console.warn("API route failed, trying edge function:",n.message);let{supabase:t}=await Promise.resolve().then(r.bind(r,5526)),{data:{session:a}}=await t.auth.getSession(),{data:s,error:i}=await t.functions.invoke("verify-bank-account",{body:e,headers:{Authorization:a?"Bearer ".concat(a.access_token):""}});if(i)throw i;if(!s)return{verified:!1,error:"No response from verification service"};if(s.error)return{verified:!1,error:s.error};return{verified:s.verified||!1,account_name:s.account_name,account_number:s.account_number,bank_id:s.bank_id}}}catch(t){console.error("Bank verification error:",t);let e=t.message||JSON.stringify(t);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))return{verified:!1,error:"Bank verification service is not available. Please check your environment variables (PAYSTACK_SECRET_KEY) and try again."};return{verified:!1,error:t.message||"Failed to verify bank account. Please try again."}}},l=async(e,t)=>{try{try{let r=await fetch("/api/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,paystackReference:t})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"HTTP error! status: ".concat(r.status))}return await r.json()}catch(o){console.warn("API route failed, trying edge function:",o.message);let{supabase:a}=await Promise.resolve().then(r.bind(r,5526)),{data:{session:s}}=await a.auth.getSession(),{data:i,error:n}=await a.functions.invoke("verify-payment",{body:{orderId:e,paystackReference:t},headers:{Authorization:s?"Bearer ".concat(s.access_token):"","Content-Type":"application/json"}});if(n)throw n;if(!i)throw Error("No response from verification service");return i}}catch(t){console.error("Payment verification error:",t);let e=t.message||JSON.stringify(t);if(e.includes("not found")||e.includes("404")||e.includes("Function not found")||e.includes("Failed to send")||e.includes("CORS"))return{verified:!1,error:"Payment verification service error. Please check your environment variables (PAYSTACK_SECRET_KEY, SUPABASE_SERVICE_ROLE_KEY) and try again."};return{verified:!1,error:t.message||"Failed to verify payment. Please try again."}}}},61980:function(e,t,r){"use strict";r.d(t,{Bt:function(){return n},D0:function(){return c},E$:function(){return x},LV:function(){return o},Lj:function(){return l},aE:function(){return h},cD:function(){return b},eJ:function(){return i},li:function(){return d},ob:function(){return p},rM:function(){return u},y6:function(){return m},yM:function(){return s},zf:function(){return f}});var a=r(5526);let s=async e=>{console.log("Creating event in database...",{creator_id:e.creator_id,title:e.title,category:e.category});let{data:t,error:r}=await a.supabase.from("events").insert({creator_id:e.creator_id,title:e.title,description:e.description,category:e.category,image_url:e.image_url,date:e.date,location:e.location,is_featured:e.is_featured||!1,status:"active"}).select().single();if(r)throw console.error("Event creation error:",r),Error("Failed to create event: ".concat(r.message," (").concat(r.code||"unknown",")"));if(!t)throw Error("Event creation returned no data");console.log("Event created, ID:",t.id),console.log("Creating ticket types...",e.ticket_types.length);let s=e.ticket_types.map(e=>({event_id:t.id,name:e.name,description:e.description,price:e.price,quantity:e.quantity,is_free:e.is_free||!1})),{error:i}=await a.supabase.from("ticket_types").insert(s);if(i)throw console.error("Ticket types creation error:",i),Error("Failed to create ticket types: ".concat(i.message," (").concat(i.code||"unknown",")"));return console.log("Ticket types created successfully"),t},i=async(e,t)=>{let{data:r,error:s}=await a.supabase.from("events").update({title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured||!1,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw Error("Failed to update event: ".concat(s.message));if(!r)throw Error("Event update returned no data");let{data:i}=await a.supabase.from("ticket_types").select("id").eq("event_id",e),n=new Set((null==i?void 0:i.map(e=>e.id))||[]),o=new Set(t.ticket_types.filter(e=>e.id).map(e=>e.id)),c=Array.from(n).filter(e=>!o.has(e));for(let r of(c.length>0&&await a.supabase.from("ticket_types").delete().in("id",c),t.ticket_types))r.id&&n.has(r.id)?await a.supabase.from("ticket_types").update({name:r.name,description:r.description,price:r.price,quantity:r.quantity,is_free:r.is_free||!1}).eq("id",r.id):await a.supabase.from("ticket_types").insert({event_id:e,name:r.name,description:r.description,price:r.price,quantity:r.quantity,is_free:r.is_free||!1});return r},n=async(e,t)=>{let{data:r,error:s}=await a.supabase.from("events").select("*").eq("id",e).eq("creator_id",t).single();if(s)throw s;if(!r)throw Error("Event not found or access denied");let{error:i}=await a.supabase.from("deleted_events").insert({original_event_id:r.id,creator_id:r.creator_id,title:r.title,description:r.description,category:r.category,image_url:r.image_url,date:r.date,location:r.location,is_featured:r.is_featured,status:"cancelled",deleted_by:t,created_at:r.created_at,updated_at:r.updated_at});if(i)throw i;let{error:n}=await a.supabase.from("events").delete().eq("id",e).eq("creator_id",t);if(n)throw n;return{success:!0}},o=async e=>{let{data:t,error:r}=await a.supabase.from("orders").insert({user_id:e.user_id,event_id:e.event_id,email:e.email,full_name:e.full_name,total_amount:e.total_amount,paystack_reference:e.paystack_reference,payment_status:e.payment_status||"pending"}).select().single();if(r)throw r;let s=e.tickets.map(r=>({ticket_type_id:r.ticket_type_id,event_id:e.event_id,user_id:e.user_id,order_id:t.id,qr_code:r.qr_code,qr_code_data:r.qr_code_data,status:(e.payment_status,"valid")})),{error:i}=await a.supabase.from("tickets").insert(s);if(i)throw i;if("paid"===e.payment_status){let t=new Map;for(let r of e.tickets){let e=t.get(r.ticket_type_id)||0;t.set(r.ticket_type_id,e+1)}for(let[e,r]of t){let{data:t}=await a.supabase.from("ticket_types").select("sold_count").eq("id",e).single();t&&await a.supabase.from("ticket_types").update({sold_count:t.sold_count+r}).eq("id",e)}}return t},c=async(e,t)=>{let{data:r,error:s}=await a.supabase.from("creator_profiles").upsert({user_id:e,...t}).select().single();if(s)throw s;return r},d=async(e,t)=>{var r;let{data:s,error:i}=await a.supabase.from("tickets").select("*, event:events!inner(creator_id, id)").eq("id",e).single();if(i||!s)throw Error("Ticket not found");if((null===(r=s.event)||void 0===r?void 0:r.creator_id)!==t)throw Error("Only the event creator can validate tickets");if("used"===s.status)throw Error("Ticket has already been validated");if("cancelled"===s.status)throw Error("Ticket has been cancelled");let{error:n}=await a.supabase.from("tickets").update({status:"used",checked_in_at:new Date().toISOString(),checked_in_by:t}).eq("id",e);if(n)throw Error("Failed to validate ticket: ".concat(n.message));return await a.supabase.from("qr_scans").insert({ticket_id:e,scanned_by:t,scan_result:"valid"}),{success:!0,ticketId:e}},l=async(e,t)=>{let{data:r,error:s}=await a.supabase.from("users").update({full_name:t.full_name,gender:t.gender,school:t.school,avatar_name:t.avatar_name,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return r},u=async e=>{let{data:t,error:r}=await a.supabase.from("events").select("*").eq("id",e).single();if(r)throw r;if(!t)throw Error("Event not found");let{error:s}=await a.supabase.from("deleted_events").insert({original_event_id:t.id,creator_id:t.creator_id,title:t.title,description:t.description,category:t.category,image_url:t.image_url,date:t.date,location:t.location,is_featured:t.is_featured,status:"cancelled",deleted_by:t.creator_id,created_at:t.created_at,updated_at:t.updated_at});if(s)throw s;let{error:i}=await a.supabase.from("events").delete().eq("id",e);if(i)throw i;return{success:!0}},m=async(e,t)=>{let{data:r,error:s}=await a.supabase.from("users").update({role:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;if("creator"===t){let{data:t}=await a.supabase.from("creator_profiles").select("id").eq("user_id",e).maybeSingle();t||await a.supabase.from("creator_profiles").insert({user_id:e})}return r},f=async(e,t)=>{let{data:r,error:s}=await a.supabase.from("users").update({banned:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return r},p=async(e,t)=>{let{data:r,error:s}=await a.supabase.from("events").update({status:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return r},h=async(e,t,r)=>{let{data:s,error:i}=await a.supabase.from("creator_profiles").select("account_balance").eq("user_id",e).single();if(i)throw i;if(!s)throw Error("Creator profile not found");let n=Number(s.account_balance)||0;if(n<t)throw Error("Insufficient balance. Available: ₦".concat(n.toLocaleString()));let{data:o,error:c}=await a.supabase.from("withdrawals").insert({creator_id:e,amount:t,status:"pending",...r}).select().single();if(c)throw c;let{error:d}=await a.supabase.from("creator_profiles").update({account_balance:n-t}).eq("user_id",e);if(d)throw d;return await a.supabase.from("wallet_transactions").insert({creator_id:e,type:"withdrawal",amount:-t,status:"pending",description:"Withdrawal request - ".concat(r.bank_name," ").concat(r.bank_account_number)}),o},x=async(e,t,r)=>{let{data:s,error:i}=await a.supabase.from("withdrawals").update({status:"approved",approved_by:t,approved_at:new Date().toISOString(),admin_note:r}).eq("id",e).select().single();if(i)throw i;return await a.supabase.from("wallet_transactions").update({status:"completed"}).eq("creator_id",s.creator_id).eq("amount",-s.amount).eq("type","withdrawal").eq("status","pending"),s},b=async(e,t,r)=>{let{data:s,error:i}=await a.supabase.from("withdrawals").select("*").eq("id",e).single();if(i)throw i;if(!s)throw Error("Withdrawal not found");let{error:n}=await a.supabase.from("withdrawals").update({status:"rejected",approved_by:t,rejected_at:new Date().toISOString(),admin_note:r}).eq("id",e);if(n)throw n;let{data:o}=await a.supabase.from("creator_profiles").select("account_balance").eq("user_id",s.creator_id).single();if(o){let e=Number(o.account_balance)||0;await a.supabase.from("creator_profiles").update({account_balance:e+Number(s.amount)}).eq("user_id",s.creator_id)}return await a.supabase.from("wallet_transactions").update({status:"failed"}).eq("creator_id",s.creator_id).eq("amount",-s.amount).eq("type","withdrawal").eq("status","pending"),s}}},function(e){e.O(0,[3227,4182,2972,5506,2642,3850,5730,758,5256,2893,1713,4438,7938,9913,8361,2971,2117,1744],function(){return e(e.s=5906)}),_N_E=e.O()}]);